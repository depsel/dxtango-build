import{j as e,r as E}from"./emotion-element-43c6fea0.browser.esm-Bukkp3pI.js";import{_ as K,R as Q,U as Y}from"./auth_context-By8qlCOz.js";import{A as Z}from"./ApiErrors-CbWmNTke.js";import{F as s}from"./FormSkeletons-C5bAoHqQ.js";import{G as T,a as r}from"./chunk-ZPFGWTBB-C6BSXP9K.js";import{H as n}from"./chunk-3ASUQ6PA-CMDtM4Gu.js";import{S as G}from"./chunk-ZHMYA64R-DxFJ4KrV.js";import{a as k,d as ee}from"./app-ChKZjo6p.js";import{D as u}from"./chunk-W7WUSNWJ-D1ck6ov6.js";import{a as re,o as se}from"./yup-DmufeRdH.js";import{a as C,F as U,b as A}from"./useDXTApiFetch-DMZ_pwG5.js";import{c as ae,A as oe}from"./validation-EHFBNvNt.js";import{a as ie,b as ne}from"./app_resources-0MHmsA5u.js";import{u as de}from"./useTangoList-BH5N6yVu.js";import{C as w}from"./CommonCard-B6Zs7VdS.js";import{C as I}from"./ControlledInput-Bfe1Y7Kq.js";import{C as te,a as m}from"./ControlledSwitch-nuCNmcKM.js";import{C as L}from"./ControlledSelect-C5AbekiF.js";import{F as le}from"./FormErrors-DK3bqFxa.js";import{d as ce,V as pe,P as me}from"./vo_dxt_password-B_Q-LXlx.js";import{I as N}from"./InlineError-DcRSvLUF.js";import{S as ue}from"./SettingsFormButtons-Dtw3fGC3.js";import{y as xe}from"./utils-DihYaFf6.js";import{c as je,a as fe}from"./index.esm-DLycO5Xl.js";import{H as D}from"./chunk-7OLJDQMT-DeTsz2JD.js";function Xe(c,l){try{return c().valueOf()}catch{}return l}const _e=()=>e.jsx(k,{width:"full",sx:{mt:8,mb:4},children:e.jsxs(T,{templateColumns:{base:"1fr",md:"repeat(2,1fr)"},alignItems:"center",gap:4,children:[e.jsx(r,{colSpan:{md:2},children:e.jsx(s,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(u,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(s,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(s,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(u,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(s,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(s,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(u,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(s,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsxs(G,{spacing:4,direction:{base:"column"},children:[e.jsx(n,{spacing:4,children:e.jsx(s,{})}),e.jsx(n,{spacing:4,children:e.jsx(s,{})}),e.jsx(n,{spacing:4,children:e.jsx(s,{})}),e.jsx(n,{spacing:4,children:e.jsx(s,{})}),e.jsx(n,{spacing:4,children:e.jsx(s,{})}),e.jsx(n,{spacing:4,children:e.jsx(s,{})}),e.jsx(n,{spacing:4,children:e.jsx(s,{})}),e.jsx(n,{spacing:4,children:e.jsx(s,{})})]})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(u,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})})]})}),he=()=>{const[c,l]=E.useState(null),t=je({password:fe().test("password","Formato de contraseña no válido",p=>{if(p!=null&&p!=""){let a=ce(p);return K.isEqual(c,a)||l(a),xe(pe,p)}return l(null),!0})}).required();return{yupValidationSchema:ae.concat(t),passwordStatus:c}},be=c=>{var F,V;const{stateData:l,typeSettings:t,returnUrl:b,title:p}=c,a={...l},P=ie(),x=ne(),{yupValidationSchema:z,passwordStatus:M}=he(),{state:j,result:y}=de({endpoint:oe,fieldsMap:{label:"name",value:"id"}}),{state:f,result:R}=t.api.useGetRelation(),{handleSubmit:H,control:i,resetField:v,setError:B,watch:X,formState:{errors:q,isSubmitting:$,isSubmitSuccessful:W}}=re({defaultValues:{username:a.username,email:a.email??"",habilitado_en_dxt:a.habilitado_en_dxt,puede_crear_pedido:a.puede_crear_pedido,puede_editar_pedido:a.puede_anular_pedido,ver_pedidos_cumplidos:a.ver_pedidos_cumplidos,ver_sin_precio:a.ver_sin_precio,mostrar_mensaje_de_advertencia:a.mostrar_mensaje_de_advertencia,puede_anular_pedido:a.puede_anular_pedido,borrar_pedido_al_anular:a.borrar_pedido_al_anular,aprobar_pedido_al_crear:a.aprobar_pedido_al_crear,dia_de_entrega:a.dia_de_entrega},resolver:se(z)}),S=X("puede_anular_pedido");E.useEffect(()=>{S===!1&&v("borrar_pedido_al_anular",{defaultValue:!1})},[S]),E.useEffect(()=>{var _,d;if(f instanceof C){const h=((_=R.find(g=>g.value===a.tango_id))==null?void 0:_.value)??void 0;v("tango_id",{defaultValue:h})}if(j instanceof C){const h=((d=y.find(g=>g.value===a.perfil_facturacion_id))==null?void 0:d.value)??void 0;v("perfil_facturacion_id",{defaultValue:h})}},[f,j]);const o=W||$,J=async _=>{const{...d}=_;d.email===""&&delete d.email,d.password===""&&delete d.password;const h=d;(await t.api.patch(a.id,h,P)).map({success:O=>{x({title:ee,status:"success"}),P.navigate(b)},error:O=>{x({title:Q,status:"error"}),B("root",{message:O.info.error_description})}})};return e.jsx("form",{noValidate:!0,onSubmit:H(J),children:e.jsxs(k,{children:[e.jsx(le,{errors:q}),e.jsx(w,{children:e.jsxs(T,{templateColumns:{base:"1fr",md:"repeat(2,1fr)"},alignItems:"start",gap:4,children:[e.jsx(r,{colSpan:{md:2},children:e.jsx(D,{size:"sm",textTransform:"uppercase",children:p})}),e.jsxs(r,{colSpan:{md:2},children:[e.jsx(L,{fieldProps:{name:"tango_id",placeholder:(F=t.tangoRelatedFields)==null?void 0:F.placeholder,options:R,noOptionsMessage(_){var d;return(d=t.tangoRelatedFields)==null?void 0:d.empty},isSearchable:!0,selectedOptionStyle:"check",isLoading:f instanceof U,virtualized:!0},formControlProps:{isDisabled:o||!(f instanceof C)},formControlInnerProps:{label:(V=t.tangoRelatedFields)==null?void 0:V.label},control:i}),f instanceof A&&e.jsx(N,{error:f.errorOrNull().error})]}),e.jsx(r,{children:e.jsx(I,{fieldProps:{name:"username",id:"username",type:"text"},formControlProps:{isDisabled:o},formControlInnerProps:{label:"Nombre de Usuario"},control:i})}),e.jsx(r,{children:e.jsx(me,{fieldProps:{name:"password",id:"password"},formControlInnerProps:{label:"Contraseña"},passwordStatus:M,disableForm:o,control:i})}),e.jsx(r,{children:e.jsx(I,{fieldProps:{name:"email",id:"email",type:"text",inputMode:"email"},formControlProps:{isDisabled:o},formControlInnerProps:{label:"Correo electrónico"},control:i})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(u,{})}),e.jsxs(r,{colSpan:{md:2},children:[e.jsx(L,{fieldProps:{name:"perfil_facturacion_id",placeholder:"Seleccione un perfil",options:y,noOptionsMessage(_){return"No hay perfiles disponibles"},isLoading:j instanceof U,selectedOptionStyle:"check"},formControlProps:{isDisabled:o||!(j instanceof C)},control:i,formControlInnerProps:{label:"Perfil de facturación"}}),j instanceof A&&e.jsx(N,{error:j.errorOrNull().error})]}),e.jsx(r,{colSpan:{md:2},children:e.jsx(u,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(D,{size:"sm",textTransform:"uppercase",children:"Estado"})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(te,{fieldProps:{name:"habilitado_en_dxt",options:[{value:!0,label:"Establecido en Tango"},{value:!1,label:"Deshabilitado"}]},formControlProps:{isDisabled:o},radioProps:{size:{base:"sm",sm:"md"}},control:i})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(u,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(D,{size:"sm",textTransform:"uppercase",children:"Comunicación"})}),e.jsx(r,{children:e.jsx(m,{fieldProps:{name:"mostrar_mensaje_de_advertencia",id:"mostrar_mensaje_de_advertencia"},formControlProps:{width:"auto",isDisabled:o},formControlInnerProps:{label:"Mostrar mensaje de advertencia"},control:i})})]})}),e.jsx(w,{children:e.jsxs(T,{templateColumns:{base:"1fr",md:"repeat(2,1fr)"},alignItems:"start",gap:4,children:[e.jsx(r,{colSpan:{md:2},children:e.jsx(D,{size:"sm",textTransform:"uppercase",children:"Pedidos"})}),e.jsx(r,{colSpan:{md:2},children:e.jsxs(G,{spacing:4,direction:{base:"column"},children:[e.jsx(n,{spacing:4,children:e.jsx(m,{fieldProps:{name:"puede_crear_pedido",id:"puede_crear_pedido"},formControlProps:{width:"auto",isDisabled:o},formControlInnerProps:{label:"Puede crear pedidos"},control:i})}),e.jsx(n,{spacing:4,children:e.jsx(m,{fieldProps:{name:"puede_editar_pedido",id:"puede_editar_pedido"},formControlProps:{width:"auto",isDisabled:o},formControlInnerProps:{label:"Puede editar pedidos"},control:i})}),e.jsx(n,{spacing:4,children:e.jsx(m,{fieldProps:{name:"puede_anular_pedido",id:"puede_anular_pedido"},formControlProps:{width:"auto",isDisabled:o},formControlInnerProps:{label:"Puede anular pedidos"},control:i})}),e.jsx(n,{spacing:4,children:e.jsx(m,{fieldProps:{name:"borrar_pedido_al_anular",id:"borrar_pedido_al_anular"},formControlProps:{width:"auto",isDisabled:o},formControlInnerProps:{label:"Borrar pedido al anular"},control:i,watch:{isDisabled:S===!1,...S===!1&&{isChecked:!1}}})}),e.jsx(n,{spacing:4,children:e.jsx(m,{fieldProps:{name:"aprobar_pedido_al_crear",id:"aprobar_pedido_al_crear"},formControlProps:{width:"auto",isDisabled:o},formControlInnerProps:{label:"Los pedidos se aprueban al crearlos"},control:i})}),e.jsx(n,{spacing:4,children:e.jsx(m,{fieldProps:{name:"ver_pedidos_cumplidos",id:"ver_pedidos_cumplidos"},formControlProps:{width:"auto",isDisabled:o},formControlInnerProps:{label:"Puede ver los pedidos cumplidos"},control:i})}),e.jsx(n,{spacing:4,children:e.jsx(m,{fieldProps:{name:"ver_sin_precio",id:"ver_sin_precio"},formControlProps:{width:"auto",isDisabled:o},formControlInnerProps:{label:"Puede ver artículos sin precio"},control:i})})]})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(u,{})}),e.jsx(r,{children:e.jsx(I,{fieldProps:{name:"dia_de_entrega",id:"dia_de_entrega",type:"number",inputMode:"tel"},formControlProps:{isDisabled:o},formControlInnerProps:{label:"Tiempo de entrega de pedidos",helperText:"Expresado en días"},control:i})}),e.jsx(r,{})]})}),e.jsx(w,{children:e.jsx(ue,{isLoading:o,hideCancelButton:!0})})]})})},qe=c=>{const{typeSettings:l,id:t,returnUrl:b,title:p}=c,{state:a,retry:P}=l.api.getOne(t);return a.map({loading:x=>e.jsx(_e,{}),error:({error:x})=>e.jsx(Z,{error:x,retry:P,cancelAndNavigateTo:Y}),success:x=>e.jsx(be,{stateData:x.data,typeSettings:l,returnUrl:b,title:p})})};export{qe as D,Xe as t};
