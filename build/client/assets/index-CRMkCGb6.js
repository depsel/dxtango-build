import{j as e,r as T,p as ne}from"./emotion-element-43c6fea0.browser.esm-Cuif_eEn.js";import{u as je}from"./useDXTApiFetch-_LSStUNh.js";import{D as we,E as Ne,F as Fe,G as Me,H as ke,I as He,J as Be,K as Ue,L as $e,M as We,N as Ve,k as Ge,l as H,O as Ee,T as qe,Q as Ke,R as Xe,S as Ye,U as Ze,V as Je,W as Qe,X as et,Y as tt,Z as st,_ as rt,$ as nt,a0 as it,a1 as at,a2 as ot,a3 as lt}from"./TextPrice-BKP0caI3.js";import{f as P,u as ct,o as Re,c as W,d as dt,j as ht,i as ut,I as V,b9 as mt,ba as _t,bb as gt,bc as ft,bd as xt,be as pt,U as jt,_ as Et,b1 as w,bf as Rt,bg as Dt,bh as Ot,bi as Tt,af as bt,bj as vt,bk as At,bl as St,ax as Ct,bm as It,bn as zt,bo as yt,bp as Lt,bq as Pt,br as wt,bs as Nt,g as J,ae,bt as De,b0 as Ft,a1 as Mt,aa as kt,aO as K,ag as Ht}from"./auth_context-B-Tcig0k.js";import{S as oe,A as Oe}from"./ApiErrors-GUSgL-Xy.js";import{a as y,F as M}from"./FormSkeletons-CoMZNYRx.js";import{N as Te,M as Bt,a as Ut,b as I,c as X}from"./Navbar-BPoDUv4m.js";import{O as be,u as $t,e as L,d as Wt,a as Vt,m as Gt,r as qt}from"./events-l6No6g-S.js";import{a as S,H as Kt,J as Xt,O as Yt,K as Zt,M as Jt}from"./app-BdYyDs5S.js";import{G,a as R}from"./chunk-ZPFGWTBB-CfuIyNTX.js";import{u as ve,S as Ae}from"./SearchField-Ciu5eLKz.js";import{P as Qt,r as es,E as C,i as ts,a as le,g as ss,b as rs}from"./index-DcejMdNG.js";import{u as Se,a as ns}from"./app_resources-CDkSSx5t.js";import{R as ce}from"./ResponsiveIconButton-Ccujq6NG.js";import{j as is,i as as}from"./AccountCancelIcon-hUm3w097.js";import{A as os,T as z,u as ls,C as de}from"./ConfirmationDialog-DIsNCiqw.js";import{F as cs}from"./index.esm-CpzYlNdn.js";import{a as ds,L as hs,b as he}from"./chunk-46CXQZ4E-bCSOgkek.js";import{V as us}from"./chunk-NTCQBYKE-BJvKyHSx.js";import{F as Q}from"./chunk-KRPLQIP4-DRGOXS8W.js";import{H as ue}from"./chunk-3ASUQ6PA-ByZtqmzd.js";import{f as ms}from"./chunk-HB6KBUMZ-CJPGLeRv.js";import{I as _s}from"./chunk-6QYXN73V-B1Nx9szV.js";import{A as N}from"./chunk-3KCBMPN5-CdY7cck7.js";import{A as ie,a as F}from"./chunk-ALC6QPCI-C2jRzl9i.js";import{T as k}from"./chunk-2OOHT3W5-y4h3Shmy.js";import{B as gs}from"./chunk-Z6RXEUPO-DTekSvPj.js";import{H as O}from"./chunk-7OLJDQMT-DB_eYbVs.js";import{C as fs}from"./chunk-CWVAJCXJ-BEmBpbZv.js";import{b as Ce,c as Ie,T as xs,a as ps}from"./chunk-T2WCTPDH-0Qni0mTa.js";var ze=P(function(t,s){const n=ct("Link",t),{className:i,isExternal:o,...l}=Re(t);return e.jsx(W.a,{target:o?"_blank":void 0,rel:o?"noopener":void 0,ref:s,className:dt("chakra-link",i),...l,__css:n})});ze.displayName="Link";var[js,ye]=ht({name:"TagStylesContext",errorMessage:`useTagStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tag />" `}),ee=P((r,t)=>{const s=ut("Tag",r),n=Re(r),i={display:"inline-flex",verticalAlign:"top",alignItems:"center",maxWidth:"100%",...s.container};return e.jsx(js,{value:s,children:e.jsx(W.span,{ref:t,...n,__css:i})})});ee.displayName="Tag";var te=P((r,t)=>{const s=ye();return e.jsx(W.span,{ref:t,noOfLines:1,...r,__css:s.label})});te.displayName="TagLabel";var Es=P((r,t)=>e.jsx(V,{ref:t,verticalAlign:"top",marginEnd:"0.5rem",...r}));Es.displayName="TagLeftIcon";var Rs=P((r,t)=>e.jsx(V,{ref:t,verticalAlign:"top",marginStart:"0.5rem",...r}));Rs.displayName="TagRightIcon";var Le=r=>e.jsx(V,{verticalAlign:"inherit",viewBox:"0 0 512 512",...r,children:e.jsx("path",{fill:"currentColor",d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})});Le.displayName="TagCloseIcon";var Ds=P((r,t)=>{const{isDisabled:s,children:n,...i}=r,l={display:"flex",alignItems:"center",justifyContent:"center",outline:"0",...ye().closeButton};return e.jsx(W.button,{ref:t,"aria-label":"close",...i,type:"button",disabled:s,__css:l,children:n||e.jsx(Le,{})})});Ds.displayName="TagCloseButton";const Os=()=>e.jsxs(e.Fragment,{children:[e.jsx(Te,{}),e.jsx(be,{children:e.jsx(S,{width:"full",sx:{mt:8,mb:4},children:e.jsxs(G,{templateColumns:"1fr",alignItems:"center",gap:4,children:[e.jsx(R,{children:e.jsx(y,{height:"120px"})}),e.jsx(R,{children:e.jsx(y,{height:"120px"})}),e.jsx(R,{children:e.jsx(y,{height:"120px"})}),e.jsx(R,{children:e.jsx(y,{height:"120px"})}),e.jsx(R,{children:e.jsx(y,{height:"120px"})}),e.jsx(R,{children:e.jsx(y,{height:"120px"})})]})})})]});function Ts(r){return r&&typeof r=="object"&&"default"in r?r.default:r}var B=Ts(T),bs=Object.assign||function(r){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(r[n]=s[n])}return r},vs=function(r,t){var s={};for(var n in r)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(r,n)&&(s[n]=r[n]);return s},me=function(t){var s=t.color,n=s===void 0?"currentColor":s,i=t.size,o=i===void 0?24:i;t.children;var l=vs(t,["color","size","children"]),d="mdi-icon "+(l.className||"");return B.createElement("svg",bs({},l,{className:d,width:o,height:o,fill:n,viewBox:"0 0 24 24"}),B.createElement("path",{d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"}))},As=B.memo?B.memo(me):me,Ss=As;const Cs=ne(Ss);let v;typeof window<"u"?v=window:typeof self<"u"?v=self:v=global;let se=null,re=null;const _e=20,Y=v.clearTimeout,ge=v.setTimeout,Z=v.cancelAnimationFrame||v.mozCancelAnimationFrame||v.webkitCancelAnimationFrame,fe=v.requestAnimationFrame||v.mozRequestAnimationFrame||v.webkitRequestAnimationFrame;Z==null||fe==null?(se=Y,re=function(t){return ge(t,_e)}):(se=function([t,s]){Z(t),Y(s)},re=function(t){const s=fe(function(){Y(n),t()}),n=ge(function(){Z(s),t()},_e);return[s,n]});function Is(r){let t,s,n,i,o,l,d;const g=typeof document<"u"&&document.attachEvent;if(!g){l=function(u){const _=u.__resizeTriggers__,x=_.firstElementChild,D=_.lastElementChild,A=x.firstElementChild;D.scrollLeft=D.scrollWidth,D.scrollTop=D.scrollHeight,A.style.width=x.offsetWidth+1+"px",A.style.height=x.offsetHeight+1+"px",x.scrollLeft=x.scrollWidth,x.scrollTop=x.scrollHeight},o=function(u){return u.offsetWidth!==u.__resizeLast__.width||u.offsetHeight!==u.__resizeLast__.height},d=function(u){if(u.target.className&&typeof u.target.className.indexOf=="function"&&u.target.className.indexOf("contract-trigger")<0&&u.target.className.indexOf("expand-trigger")<0)return;const _=this;l(this),this.__resizeRAF__&&se(this.__resizeRAF__),this.__resizeRAF__=re(function(){o(_)&&(_.__resizeLast__.width=_.offsetWidth,_.__resizeLast__.height=_.offsetHeight,_.__resizeListeners__.forEach(function(A){A.call(_,u)}))})};let a=!1,h="";n="animationstart";const c="Webkit Moz O ms".split(" ");let m="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),E="";{const u=document.createElement("fakeelement");if(u.style.animationName!==void 0&&(a=!0),a===!1){for(let _=0;_<c.length;_++)if(u.style[c[_]+"AnimationName"]!==void 0){E=c[_],h="-"+E.toLowerCase()+"-",n=m[_],a=!0;break}}}s="resizeanim",t="@"+h+"keyframes "+s+" { from { opacity: 0; } to { opacity: 0; } } ",i=h+"animation: 1ms "+s+"; "}const p=function(a){if(!a.getElementById("detectElementResize")){const h=(t||"")+".resize-triggers { "+(i||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',c=a.head||a.getElementsByTagName("head")[0],m=a.createElement("style");m.id="detectElementResize",m.type="text/css",r!=null&&m.setAttribute("nonce",r),m.styleSheet?m.styleSheet.cssText=h:m.appendChild(a.createTextNode(h)),c.appendChild(m)}};return{addResizeListener:function(a,h){if(g)a.attachEvent("onresize",h);else{if(!a.__resizeTriggers__){const c=a.ownerDocument,m=v.getComputedStyle(a);m&&m.position==="static"&&(a.style.position="relative"),p(c),a.__resizeLast__={},a.__resizeListeners__=[],(a.__resizeTriggers__=c.createElement("div")).className="resize-triggers";const E=c.createElement("div");E.className="expand-trigger",E.appendChild(c.createElement("div"));const u=c.createElement("div");u.className="contract-trigger",a.__resizeTriggers__.appendChild(E),a.__resizeTriggers__.appendChild(u),a.appendChild(a.__resizeTriggers__),l(a),a.addEventListener("scroll",d,!0),n&&(a.__resizeTriggers__.__animationListener__=function(x){x.animationName===s&&l(a)},a.__resizeTriggers__.addEventListener(n,a.__resizeTriggers__.__animationListener__))}a.__resizeListeners__.push(h)}},removeResizeListener:function(a,h){if(g)a.detachEvent("onresize",h);else if(a.__resizeListeners__.splice(a.__resizeListeners__.indexOf(h),1),!a.__resizeListeners__.length){a.removeEventListener("scroll",d,!0),a.__resizeTriggers__.__animationListener__&&(a.__resizeTriggers__.removeEventListener(n,a.__resizeTriggers__.__animationListener__),a.__resizeTriggers__.__animationListener__=null);try{a.__resizeTriggers__=!a.removeChild(a.__resizeTriggers__)}catch{}}}}}class zs extends T.Component{constructor(...t){super(...t),this.state={height:this.props.defaultHeight||0,scaledHeight:this.props.defaultHeight||0,scaledWidth:this.props.defaultWidth||0,width:this.props.defaultWidth||0},this._autoSizer=null,this._detectElementResize=null,this._parentNode=null,this._resizeObserver=null,this._timeoutId=null,this._onResize=()=>{this._timeoutId=null;const{disableHeight:s,disableWidth:n,onResize:i}=this.props;if(this._parentNode){const o=window.getComputedStyle(this._parentNode)||{},l=parseFloat(o.paddingLeft||"0"),d=parseFloat(o.paddingRight||"0"),g=parseFloat(o.paddingTop||"0"),p=parseFloat(o.paddingBottom||"0"),f=this._parentNode.getBoundingClientRect(),j=f.height-g-p,a=f.width-l-d,h=this._parentNode.offsetHeight-g-p,c=this._parentNode.offsetWidth-l-d;(!s&&(this.state.height!==h||this.state.scaledHeight!==j)||!n&&(this.state.width!==c||this.state.scaledWidth!==a))&&(this.setState({height:h,width:c,scaledHeight:j,scaledWidth:a}),typeof i=="function"&&i({height:h,scaledHeight:j,scaledWidth:a,width:c}))}},this._setRef=s=>{this._autoSizer=s}}componentDidMount(){const{nonce:t}=this.props,s=this._autoSizer?this._autoSizer.parentNode:null;if(s!=null&&s.ownerDocument&&s.ownerDocument.defaultView&&s instanceof s.ownerDocument.defaultView.HTMLElement){this._parentNode=s;const n=s.ownerDocument.defaultView.ResizeObserver;n!=null?(this._resizeObserver=new n(()=>{this._timeoutId=setTimeout(this._onResize,0)}),this._resizeObserver.observe(s)):(this._detectElementResize=Is(t),this._detectElementResize.addResizeListener(s,this._onResize)),this._onResize()}}componentWillUnmount(){this._parentNode&&(this._detectElementResize&&this._detectElementResize.removeResizeListener(this._parentNode,this._onResize),this._timeoutId!==null&&clearTimeout(this._timeoutId),this._resizeObserver&&this._resizeObserver.disconnect())}render(){const{children:t,defaultHeight:s,defaultWidth:n,disableHeight:i=!1,disableWidth:o=!1,doNotBailOutOnEmptyChildren:l=!1,nonce:d,onResize:g,style:p={},tagName:f="div",...j}=this.props,{height:a,scaledHeight:h,scaledWidth:c,width:m}=this.state,E={overflow:"visible"},u={};let _=!1;return i||(a===0&&(_=!0),E.height=0,u.height=a,u.scaledHeight=h),o||(m===0&&(_=!0),E.width=0,u.width=m,u.scaledWidth=c),l&&(_=!1),T.createElement(f,{ref:this._setRef,style:{...E,...p},...j},!_&&t(u))}}const ys=r=>{const{isDraft:t,isOpen:s,onClose:n}=r,i=T.useRef(),{state:o,retry:l}=is(),d=()=>{const{filteredData:g,handleSearchInputChange:p}=ve(i.current??[],["screen_name"]),f=30,j=({style:a,index:h,data:c})=>{const m=c==null?void 0:c[h];return m!=null?e.jsx(e.Fragment,{children:e.jsx(hs,{style:a,children:m.habilitado?e.jsx(ze,{href:w(t?Rt:Dt,{client:m.id}),children:e.jsxs(S,{children:[e.jsx(he,{as:os,color:"green.400"}),m.screen_name]})}):e.jsxs(S,{color:"gray.400",sx:{cursor:"not-allowed"},children:[e.jsx(he,{as,color:"red.400"}),m.screen_name]})},m.id)}):e.jsx(e.Fragment,{})};return e.jsxs(e.Fragment,{children:[e.jsx(S,{sx:{pb:4},children:e.jsx(Ae,{handleSearchInputChange:p})}),e.jsx(zs,{children:({height:a,width:h})=>e.jsx(cs,{height:a-60,itemCount:g.length??0,itemSize:f,innerElementType:ds,width:h,itemData:g,children:j})})]})};return e.jsxs(mt,{isCentered:!0,isOpen:s,onClose:n,scrollBehavior:"inside",size:{base:"full",sm:"md",md:"lg"},children:[e.jsx(_t,{bg:"blackAlpha.800"}),e.jsxs(gt,{sx:{maxHeight:"auto"},children:[e.jsx(ft,{children:"Seleccione el cliente"}),e.jsx(xt,{}),e.jsx(pt,{minHeight:{base:"auto",sm:"420px !important"},children:o.map({loading:g=>e.jsxs(us,{spacing:4,children:[e.jsx(oe,{width:"full",height:"36px",borderRadius:"md"}),e.jsx(oe,{width:"full",height:"250px",borderRadius:"md"})]}),error:({error:g})=>e.jsx(Oe,{error:g,retry:l,cancelAndNavigateTo:jt}),success:g=>(i.current=Et.sortBy(g.data,["screen_name"]),e.jsx(d,{}))})})]})]})},Ls=({isDraft:r,pedidos:t,stateRenglones:s,handleSearchInputChange:n})=>{const i=Se(),[o,l]=T.useState(!1),{isOpen:d,onOpen:g,onClose:p}=$t(),[f,j]=T.useState([]);T.useRef({pedidos:[],renglones:{}}),T.useEffect(()=>{const E=({id:u,checked:_})=>{j(_?x=>[...x,u]:x=>x.filter(D=>D!==u))};return L.on("setUnsetSelectedPedido",E),()=>{L.removeListener("setUnsetSelectedPedido",E)}},[]);const a=()=>{if(i.authState.isCustomer()){i.navigate(r?vt:At);return}l(!0),g()},h=()=>{p(),l(!1)},c=()=>{Array.isArray(f)&&window.open(`${St}?orderId=${f.join("&orderId=")}`,"OrderPrintWindow","width=640,height=480")},m=f.length<=0?void 0:f.length==1?`1 ${Kt}`:`${f.length} ${Xt}`;return e.jsxs(e.Fragment,{children:[e.jsxs(Q,{flex:1,alignItems:"center",justifyContent:"space-between",sx:{mx:4},children:[e.jsxs(ue,{spacing:{base:2,sm:3},alignItems:"center",children:[(i.authState.isSeller()||i.authState.isCustomer())&&e.jsx(e.Fragment,{children:e.jsx(ce,{icon:Cs,text:r?Ot:Tt,sharedProps:{size:"sm",fontWeight:"400",colorScheme:r?"green":"orange",onClick:()=>{a()},isDisabled:!r&&!i.authState.userInfo.puede_crear_pedido},iconProps:{boxSize:{base:5,md:4}}})}),!r&&e.jsx(ce,{icon:Qt,text:bt,sharedProps:{size:"sm",fontWeight:"400",colorScheme:"blue",onClick:()=>c(),isDisabled:f.length<=0},iconProps:{boxSize:{base:5,md:4}}}),m!=null&&e.jsxs(e.Fragment,{children:[e.jsx(ee,{display:{base:"none",sm:"inherited"},height:8,borderRadius:40,size:"md",variant:"solid",colorScheme:"blue",children:e.jsx(te,{marginX:1,children:m})}),e.jsx(ee,{display:{base:"inherited",sm:"none"},height:8,borderRadius:40,size:"md",variant:"solid",colorScheme:"blue",children:e.jsx(te,{marginX:1,children:f.length})})]})]}),e.jsx(Q,{alignItems:"center",marginLeft:4,children:e.jsx(ue,{spacing:{base:2,md:4},children:e.jsx(S,{children:e.jsx(Ae,{handleSearchInputChange:n})})})})]}),o&&e.jsx(ys,{isDraft:r,isOpen:d,onClose:h})]})};function Ps(r){return r&&typeof r=="object"&&"default"in r?r.default:r}var U=Ps(T),ws=Object.assign||function(r){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(r[n]=s[n])}return r},Ns=function(r,t){var s={};for(var n in r)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(r,n)&&(s[n]=r[n]);return s},xe=function(t){var s=t.color,n=s===void 0?"currentColor":s,i=t.size,o=i===void 0?24:i;t.children;var l=Ns(t,["color","size","children"]),d="mdi-icon "+(l.className||"");return U.createElement("svg",ws({},l,{className:d,width:o,height:o,fill:n,viewBox:"0 0 24 24"}),U.createElement("path",{d:"M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"}))},Fs=U.memo?U.memo(xe):xe,Ms=Fs;const ks=ne(Ms);function Hs(r,t){return t.isSuccess()?es(r,t.data[r.id]):r.estado}function Pe(r,t){let s;switch(r){case C.INGRESADO:s="blue";break;case C.APROBADO:s="purple";break;case C.CUMPLIDO:s="green";break;case C.CERRADO:s="black";break;case C.ANULADO:s="red";break;default:s="gray"}return t==null?s:`${s}${t}`}function Bs(r){return r&&typeof r=="object"&&"default"in r?r.default:r}var $=Bs(T),Us=Object.assign||function(r){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(r[n]=s[n])}return r},$s=function(r,t){var s={};for(var n in r)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(r,n)&&(s[n]=r[n]);return s},pe=function(t){var s=t.color,n=s===void 0?"currentColor":s,i=t.size,o=i===void 0?24:i;t.children;var l=$s(t,["color","size","children"]),d="mdi-icon "+(l.className||"");return $.createElement("svg",Us({},l,{className:d,width:o,height:o,fill:n,viewBox:"0 0 24 24"}),$.createElement("path",{d:"M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z"}))},Ws=$.memo?$.memo(pe):pe,Vs=Ws;const Gs=ne(Vs),qs=({app:r,isDraft:t,pedido:s,onDelete:n,onMarkAsFavorite:i})=>{const o=r.authState.userInfo,l=r.authState.isAdmin(),d=t&&s.es_favorito,g=!l&&o.puede_crear_pedido,p=!l&&(t||o.puede_editar_pedido&&ts(o,s.estado)),f=!l&&!d&&(t||le(o,s.estado)),j=t||o.borrar_pedido_al_anular;return e.jsxs(ms,{isLazy:!0,id:"menu",children:[e.jsx(Bt,{as:_s,size:"sm","aria-label":Yt,icon:e.jsx(Gs,{}),variant:"outline",colorScheme:"white"}),e.jsx(Ct,{children:e.jsxs(Ut,{rootProps:{zIndex:2e3},children:[p&&e.jsx(I,{onClick:()=>{r.navigate(w(t?It:zt,{id:s.id}))},children:we}),(t||g)&&e.jsx(I,{onClick:()=>{r.navigate(w(t?yt:Lt,{id:s.id}))},children:Ne}),(!t||g)&&e.jsx(I,{onClick:()=>{r.navigate(w(t?Pt:wt,{id:s.id}))},children:t?d?Fe:Me:ke}),t&&!d&&e.jsxs(e.Fragment,{children:[g&&e.jsx(I,{onClick:()=>{r.navigate(w(Nt,{id:s.id}))},children:He}),e.jsx(X,{}),e.jsx(I,{onClick:()=>i(s.id,!0),children:Be})]}),t&&d&&e.jsxs(e.Fragment,{children:[e.jsx(X,{}),e.jsx(I,{onClick:()=>i(s.id,!1),children:Ue})]}),(t||le(o,s.estado))&&e.jsxs(e.Fragment,{children:[e.jsx(X,{}),e.jsx(I,{onClick:()=>n(s.id),isDisabled:!f,children:d?$e:j?We:Ve})]})]})})]})},Ks=()=>e.jsxs(N,{status:"warning",children:[e.jsx(ie,{}),e.jsx(F,{children:"El pedido no cuenta con productos."})]}),Xs=()=>e.jsxs(N,{status:"error",children:[e.jsx(ie,{}),e.jsx(F,{children:"Ocurrió un error al cargar los detalles del pedido."})]}),Ys=()=>e.jsx(S,{width:"full",sx:{mt:8,mb:4},children:e.jsxs(G,{templateColumns:"1fr",alignItems:"center",gap:2,children:[e.jsx(R,{children:e.jsx(M,{height:"20px"})}),e.jsx(R,{children:e.jsx(M,{height:"20px"})}),e.jsx(R,{children:e.jsx(M,{height:"20px"})}),e.jsx(R,{children:e.jsx(M,{height:"20px"})})]})}),Zs=({nro_pedido:r,renglones:t})=>{const s=J("var(--chakra-colors-gray-200)","var(--chakra-colors-black)"),n=J("var(--chakra-colors-gray-400)","var(--chakra-colors-black)");return e.jsxs("table",{width:"100%",cellPadding:8,cellSpacing:4,style:{fontSize:"0.8rem",border:`1px solid ${n}`},children:[e.jsx("thead",{style:{backgroundColor:`${s}`,textTransform:"uppercase"},children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left",style:{width:"55%"},children:"Artículo"}),e.jsx("th",{className:"text-right hidden-on-base",style:{width:"10%"},children:"Precio"}),e.jsx("th",{className:"text-center",style:{width:"12%"},children:"Cant."}),e.jsx("th",{className:"text-right",style:{width:"13%"},children:"Subtotal"})]})}),e.jsx("tbody",{children:t.map(({id_articulo:i,nombre_articulo:o,codigo_articulo:l,descripcion_adicional:d,precio:g,cantidad:p,subtotal:f},j)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(z,{children:Ge(o,l,d)})}),e.jsx("td",{className:"text-right hidden-on-base",children:e.jsx(H,{precio:g,moneda:"$"})}),e.jsx("td",{children:e.jsx(k,{textAlign:"center",children:p})}),e.jsx("td",{className:"text-right",children:e.jsx(H,{precio:f,moneda:"$"})})]},`details-${r}-${j}`))})]})},Js=({wasOpen:r,pedido:t,stateRenglones:s})=>e.jsx(S,{sx:{mt:6},children:r&&s.map({loading:n=>e.jsx(Ys,{}),error:n=>e.jsx(Xs,{}),success:n=>{var d;const{id:i,numero_pedido:o}=t,l=(d=n.data)==null?void 0:d[i];return Array.isArray(l)?e.jsx(Zs,{nro_pedido:o,renglones:l}):e.jsx(Ks,{})}})}),Qs=({estado:r})=>{const t=ss(r),s=Pe(r);return e.jsx(gs,{fontSize:"1em",variant:"solid",colorScheme:s,lineHeight:"1.5em",children:t})},er=r=>{const{app:t,pedido:s,total:n,estado:i,handleToggleDetails:o}=r,{numero_pedido:l,fecha_alta:d,fecha_entrega:g,codigo_cliente:p,codigo_vendedor:f,codigo_transporte:j,nombre_cliente:a,nombre_vendedor:h,nombre_transporte:c,descuento:m,comentarios:E,sin_iva:u,sin_ii:_}=s,x=t.authState.isSeller(),D=t.authState.isCustomer(),A=E!=null&&E.length>0;return e.jsxs(G,{templateColumns:{base:"repeat(2, 1fr)",lg:"repeat(4, 1fr)"},gap:6,sx:{cursor:"pointer"},onClick:()=>{o()},children:[e.jsxs(R,{children:[e.jsx(O,{size:"sm",children:"Pedido"}),e.jsx(k,{children:l})]}),e.jsxs(R,{children:[e.jsx(O,{size:"sm",children:"Estado"}),e.jsx(Qs,{estado:i})]}),e.jsxs(R,{children:[e.jsx(O,{size:"sm",children:"Emisión"}),e.jsx(k,{children:ae(d)})]}),e.jsxs(R,{children:[e.jsx(O,{size:"sm",children:"Entrega"}),e.jsx(k,{children:ae(g)})]}),!D&&e.jsxs(R,{...x?{colSpan:{base:1,lg:2}}:void 0,children:[e.jsxs(O,{size:"sm",children:["Cliente ",p]}),e.jsx(z,{children:a})]}),!x&&!D&&e.jsxs(R,{children:[e.jsxs(O,{size:"sm",children:["Vendedor ",f]}),e.jsx(z,{children:h})]}),e.jsxs(R,{...D?{colSpan:{base:1,lg:3}}:void 0,...x?{colSpan:{base:1,lg:1}}:void 0,children:[e.jsxs(O,{size:"sm",children:["Transporte ",j]}),e.jsx(z,{children:c})]}),e.jsxs(R,{...x?{colSpan:{base:2,lg:1}}:void 0,children:[e.jsxs(O,{size:"sm",sx:{textTransform:"uppercase",color:i===C.APROBADO&&"green.400",whiteSpace:"normal"},children:["Total ",m>0&&e.jsx(e.Fragment,{children:` -${m}%`}),e.jsxs("span",{style:{fontSize:"small"},children:[" ",`(${Ee(u,_)})`]})]}),e.jsx(O,{size:"sm",sx:{fontWeight:"bolder",color:i===C.APROBADO&&"green.400"},children:n!=null&&e.jsx(H,{precio:n,moneda:"$"})})]}),A&&e.jsx(R,{colSpan:{base:2,lg:4},children:e.jsx(N,{status:"info",children:e.jsx(F,{dangerouslySetInnerHTML:{__html:De(E)},sx:{whiteSpace:"normal"}})})})]})},tr=r=>{const{app:t,pedido:s,estado:n,total:i,handleToggleDetails:o}=r,{codigo_cliente:l,codigo_vendedor:d,codigo_transporte:g,nombre_cliente:p,nombre_vendedor:f,nombre_transporte:j,descuento:a,comentarios:h,descripcion:c,es_favorito:m,sin_iva:E,sin_ii:u}=s,_=t.authState.isSeller(),x=t.authState.isCustomer(),D=h!=null&&h.length>0,A={base:_||x?1:2,md:_?2:x?1:2,lg:_?3:x?2:4},b={base:_||x?"repeat(1, 1fr)":"repeat(2, 1fr)",md:_?"repeat(2, 1fr)":x?"repeat(1, 1fr)":"repeat(2, 1fr)",lg:_?"repeat(3, 1fr)":x?"repeat(2, 1fr)":"repeat(4, 1fr)"};return e.jsxs(G,{templateColumns:b,gap:6,sx:{cursor:"pointer"},onClick:()=>{o()},children:[e.jsx(R,{colSpan:A,children:e.jsx(O,{size:"md",textTransform:"uppercase",children:c})}),!x&&e.jsxs(R,{children:[e.jsxs(O,{size:"sm",children:["Cliente ",l]}),e.jsx(z,{children:p})]}),!_&&!x&&e.jsxs(R,{children:[e.jsxs(O,{size:"sm",children:["Vendedor ",d]}),e.jsx(z,{children:f})]}),e.jsxs(R,{children:[e.jsxs(O,{size:"sm",children:["Transporte ",g]}),e.jsx(z,{children:j})]}),e.jsxs(R,{children:[e.jsxs(O,{size:"sm",sx:{textTransform:"uppercase",color:n===C.APROBADO&&"green.400",whiteSpace:"normal"},children:["Total ",a>0&&e.jsx(e.Fragment,{children:` -${a}%`}),e.jsxs("span",{style:{fontSize:"small"},children:[" ",`(${Ee(E,u)})`]})]}),e.jsx(O,{size:"sm",sx:{fontWeight:"bolder",color:n===C.APROBADO&&"green.400"},children:i!=null&&e.jsx(H,{precio:i,moneda:"$"})})]}),D&&e.jsx(R,{colSpan:{base:2,lg:4},children:e.jsx(N,{status:"info",children:e.jsx(F,{dangerouslySetInnerHTML:{__html:De(h)},sx:{whiteSpace:"normal"}})})})]})};function sr(r,t){return t.isSuccess()?rs(r,t.data[r.id]):null}const rr=({index:r,app:t,draft:s,pedido:n,stateRenglones:i,handleDelete:o,handleMarkAsFavorite:l,isHidden:d})=>{const[g,p]=T.useState(!1),[f,j]=T.useState(!1),a=J("gray.800","white"),h=T.useRef(!1),c=Hs(n,i),m=n.total!=null?n.total:sr(n,i),E=T.useMemo(()=>e.jsx(Js,{wasOpen:h.current,pedido:n,stateRenglones:i}),[h.current,i.constructor.name]),u=()=>{const b=!g;b&&(h.current=!0),p(b),L.emit("togglePedidoDetails",{id:n.id})},_=(b,q)=>{j(!!b),L.emit("setUnsetSelectedPedido",{id:q,checked:b})};T.useEffect(()=>{const b=({id:q})=>{n.id!==q&&p(!1)};return L.on("togglePedidoDetails",b),()=>{L.removeListener("togglePedidoDetails",b)}},[]);const{id:x,es_favorito:D}=n,A=s&&D;return e.jsx(Ce,{sx:{...d&&!f&&{display:"none"}},children:e.jsxs(Ie,{sx:{py:6,position:"relative",borderTopWidth:s?void 0:{base:"3px",md:"4px"},borderTopStyle:s?void 0:"solid",borderTopColor:s?void 0:Pe(c,".500 !important"),borderWidth:s?{base:"2px",md:"3px"}:void 0,borderStyle:s?"dashed":void 0,borderColor:s?D?"orange.500 !important":"blue.500 !important":void 0},children:[e.jsxs(S,{display:"flex",sx:{position:"absolute",right:2,top:5},flexDirection:"column",children:[e.jsx(qs,{app:t,isDraft:s,pedido:n,onDelete:o,onMarkAsFavorite:l}),A&&e.jsx(Q,{backgroundColor:"orange",justifyContent:"center",alignItems:"center",sx:{mt:2,borderRadius:4,aspectRatio:1},children:e.jsx(V,{as:ks,boxSize:4,color:"white"})}),!s&&e.jsx(fs,{size:"xl",colorScheme:"blue",sx:{mt:2,borderWidth:0,borderColor:a},onChange:b=>{_(b.target.checked,x)}})]}),s?e.jsx(tr,{app:t,pedido:n,estado:c,total:m,handleToggleDetails:u}):e.jsx(er,{app:t,pedido:n,estado:c,total:m,handleToggleDetails:u}),e.jsx(S,{children:e.jsx(S,{sx:{display:g?"block":"none"},children:E})},`pedido-details-${r}`)]})})};function nr(r){const t=Se(),n=t.authState.userInfo.borrar_pedido_al_anular.valueOf(),{draft:i,unfilteredPedidos:o,filteredPedidos:l,isFiltering:d,stateRenglones:g,reloadData:p}=r,f=ns(),j=ls(),a=async c=>{if(await j({title:i?Ke:n?Xe:Ye,message:i?Ze:n?Je:Qe})==de.accept){const E=i?await Wt(c,t):await Vt(c,t);E.map({success:u=>{f({title:i?et:n?tt:st,status:"success"})},error:u=>{f({title:Mt,status:"error"})}}),E.isSuccess()&&await p()}},h=async(c,m)=>{if(m){(await Gt(c,t)).isSuccess()&&await p();return}await j({title:rt,message:nt})==de.accept&&(await qt(c,t)).isSuccess()&&await p()};return e.jsx(qe,{sx:{p:0,m:0},children:e.jsx(xs,{variant:"stripedOverCard",colorScheme:"gray",size:"md",sx:{borderCollapse:"separate",borderSpacing:"0 1rem"},children:e.jsxs(ps,{children:[o.map((c,m)=>e.jsx(rr,{index:m,draft:i,app:t,pedido:c,stateRenglones:g,handleDelete:a,handleMarkAsFavorite:h,isHidden:d&&!l.includes(c)},`pedido-${c.id}`)),!l.length&&e.jsx(Ce,{children:e.jsx(Ie,{children:e.jsxs(N,{status:"info",children:[e.jsx(ie,{}),e.jsx(F,{children:d?Ft:i?Zt:Jt})]})})})]})})})}const ir=r=>{const{showDrafts:t,pedidos:s,reloadData:n}=r,i=kt().state.userOrThrow(),o=i.role==K.admin;i.role==K.seller;const l=i.role==K.customer,{filteredData:d,handleSearchInputChange:g,isFiltering:p}=ve(s,["descripcion","comentarios",...t?[]:["numero_pedido"],...l?[]:["codigo_cliente","nombre_cliente"],...o?["codigo_vendedor","nombre_vendedor"]:[]]),{state:f}=je({...t?it:at,silent:!0,transformResponse:j=>(Object.values(j).forEach(a=>{Array.isArray(a)&&a.sort((h,c)=>h.renglon-c.renglon)}),j)});return e.jsxs(e.Fragment,{children:[e.jsx(Te,{children:e.jsx(Ls,{isDraft:t,pedidos:s,stateRenglones:f,handleSearchInputChange:g})}),e.jsx(be,{children:e.jsx(nr,{draft:t,stateRenglones:f,unfilteredPedidos:s,filteredPedidos:d,isFiltering:p,reloadData:n})})]})},Mr=r=>{const t=r.showDrafts===!0,{state:s,retry:n,reload:i}=je({...t?ot:lt,silent:!0});return s.map({loading:o=>e.jsx(Os,{}),error:({error:o})=>e.jsx(Oe,{error:o,retry:n,cancelAndNavigateTo:Ht}),success:o=>{const l=t?o.data.sort(ar):o.data.sort(or);return e.jsx(ir,{showDrafts:t,pedidos:l,reloadData:i})}})};function ar(r,t){const s=r.es_favorito?1:0,n=t.es_favorito?1:0,i=s-n;if(i!=0)return i;const o=new Date(r.fecha_ingreso).getTime();return new Date(t.fecha_ingreso).getTime()-o}function or(r,t){const s=r.estado-t.estado;if(s!=0)return s;const n=r.fecha_entrega!=null?new Date(r.fecha_entrega).getTime():0,i=t.fecha_entrega!=null?new Date(t.fecha_entrega).getTime():0,o=n-i;if(o!=0)return o;const l=new Date(r.fecha_alta).getTime(),d=new Date(t.fecha_alta).getTime();return l-d}export{Mr as O};
