import{j as e,r as I,a as J,u as Q}from"./emotion-element-43c6fea0.browser.esm-V7CwUVk-.js";import{A as Y,s as Z}from"./index-C9yDa_R-.js";import{i as ee}from"./schema_validators-DYZyRgjg.js";import{S as L,_ as re,a3 as U,X as se,e as k}from"./auth_context-BBDV2-qW.js";import{B as G,l as oe,m as ae,n as ie}from"./app-BMvraJRd.js";import{C as te}from"./CommonErrors-BtbwGIG0.js";import{S as ne}from"./SettingsFormHeading-BZPNDeWv.js";import{A as de}from"./ApiErrors-P5QuqGMt.js";import{F as s}from"./FormSkeletons-xJlZdIll.js";import{G as E,a as r}from"./chunk-ZPFGWTBB-BQOfC-td.js";import{H as t}from"./chunk-3ASUQ6PA-CvzJqsz3.js";import{D as x}from"./chunk-W7WUSNWJ-BEqd18B9.js";import{a as le,b as pe}from"./app_resources-CxShxcx8.js";import{u as ce}from"./useTangoList-Bq-SEz1p.js";import{c as me,a as ue,d as xe,o as je}from"./index.esm-SP9Jm6Nz.js";import{a as P,F as A,b as O}from"./useDXTApiFetch-cUHsby58.js";import{C as v}from"./CommonCard-CrzQbbIu.js";import{C as w}from"./ControlledInput-Bw-P79we.js";import{c as fe,C as _e,a as u}from"./validation-B8S6Yb_c.js";import{C as V}from"./ControlledSelect-Bgaw0xLO.js";import{F as he}from"./FormErrors-5HYi3DVI.js";import{d as Se,V as be,P as Pe}from"./vo_dxt_password-W93vgryN.js";import{I as N}from"./InlineError-DRfvy1Jn.js";import{S as ge}from"./SettingsFormButtons-BuGsXUqX.js";import{y as Ce}from"./utils-DihYaFf6.js";import{H as g}from"./chunk-7OLJDQMT-3EhHOSPR.js";import"./AccountCancelIcon-BsdBUfF1.js";import"./chunk-3KCBMPN5-70uOg14b.js";import"./chunk-QURMB2UJ-8Wtwm6sR.js";import"./chunk-KRPLQIP4-NJec_PE4.js";import"./chunk-6QYXN73V-BKD6YrO0.js";import"./chunk-2OOHT3W5-DslbJMnr.js";import"./chunk-GOJLRND4-C6AoJZLh.js";import"./chunk-3Y4YXCR2-DS9dcu0f.js";import"./chunk-56K2BSAJ-ByH33m4W.js";import"./chunk-YQO7BFFX-B4KLri48.js";import"./chunk-MFVQSVQB-BInMUJ5Q.js";import"./chunk-6CVSDS6C-EjyqZFPp.js";import"./chunk-7D6N5TE5-CYpHZTLA.js";import"./index.esm-DYgtBHkz.js";import"./select-BgjIqqU7.js";import"./chunk-HB6KBUMZ-jk1Ar7Nh.js";import"./chunk-46CXQZ4E-Cu23NgCw.js";import"./chunk-2ZHRCML3-DK3i-inn.js";import"./chunk-Z6RXEUPO-DSTG9QiY.js";const ve=()=>e.jsx(G,{width:"full",sx:{mt:8,mb:4},children:e.jsxs(E,{templateColumns:{base:"1fr",md:"repeat(2,1fr)"},alignItems:"center",gap:4,children:[e.jsx(r,{colSpan:{md:2},children:e.jsx(s,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(x,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(s,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(s,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(x,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(s,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(s,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(x,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(s,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsxs(L,{spacing:4,direction:{base:"column"},children:[e.jsx(t,{spacing:4,children:e.jsx(s,{})}),e.jsx(t,{spacing:4,children:e.jsx(s,{})}),e.jsx(t,{spacing:4,children:e.jsx(s,{})}),e.jsx(t,{spacing:4,children:e.jsx(s,{})}),e.jsx(t,{spacing:4,children:e.jsx(s,{})}),e.jsx(t,{spacing:4,children:e.jsx(s,{})}),e.jsx(t,{spacing:4,children:e.jsx(s,{})}),e.jsx(t,{spacing:4,children:e.jsx(s,{})})]})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(x,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})})]})}),we=()=>{const[c,l]=I.useState(null),n=me({password:ue().test("password","Formato de contraseña no válido",m=>{if(m!=null&&m!=""){let p=Se(m);return re.isEqual(c,p)||l(p),Ce(be,m)}return l(null),!0})}).required();return{yupValidationSchema:fe.concat(n),passwordStatus:c}},Ie=c=>{var F,R;const{stateData:l,typeSettings:n}=c,o={...l},m=le(),p=pe(),{yupValidationSchema:z,passwordStatus:H}=we(),{state:j,result:D}=ce({endpoint:Y,fieldsMap:{label:"name",value:"id"}}),{state:f,result:T}=n.api.getRelation(),{handleSubmit:M,control:i,resetField:C,setError:B,watch:q,formState:{errors:X,isSubmitting:$,isSubmitSuccessful:K}}=xe({defaultValues:{username:o.username,email:o.email??"",habilitado_en_dxt:o.habilitado_en_dxt,puede_crear_pedido:o.puede_crear_pedido,puede_editar_pedido:o.puede_anular_pedido,ver_pedidos_cumplidos:o.ver_pedidos_cumplidos,ver_sin_precio:o.ver_sin_precio,mostrar_mensaje_de_advertencia:o.mostrar_mensaje_de_advertencia,puede_anular_pedido:o.puede_anular_pedido,borrar_pedido_al_anular:o.borrar_pedido_al_anular,aprobar_pedido_al_crear:o.aprobar_pedido_al_crear,dia_de_entrega:o.dia_de_entrega},resolver:je(z)}),S=q("puede_anular_pedido");I.useEffect(()=>{S===!1&&C("borrar_pedido_al_anular",{defaultValue:!1})},[S]),I.useEffect(()=>{var _,d;if(f instanceof P){const h=((_=T.find(b=>b.value===o.tango_id))==null?void 0:_.value)??void 0;C("tango_id",{defaultValue:h})}if(j instanceof P){const h=((d=D.find(b=>b.value===o.perfil_facturacion_id))==null?void 0:d.value)??void 0;C("perfil_facturacion_id",{defaultValue:h})}},[f,j]);const a=K||$,W=async _=>{const{...d}=_;d.email===""&&delete d.email,d.password===""&&delete d.password;const h=d;(await n.api.patch(o.id,h,m)).map({success:y=>{p({title:oe,status:"success"}),m.navigate(U)},error:y=>{p({title:se,status:"error"}),B("root",{message:y.info.error_description})}})};return e.jsx("form",{noValidate:!0,onSubmit:M(W),children:e.jsxs(G,{children:[e.jsx(he,{errors:X}),e.jsx(v,{children:e.jsxs(E,{templateColumns:{base:"1fr",md:"repeat(2,1fr)"},alignItems:"start",gap:4,children:[e.jsx(r,{colSpan:{md:2},children:e.jsx(g,{size:"sm",textTransform:"uppercase",children:"Información del Cliente"})}),e.jsxs(r,{colSpan:{md:2},children:[e.jsx(V,{fieldProps:{name:"tango_id",placeholder:(F=n.tangoRelatedFields)==null?void 0:F.placeholder,options:T,noOptionsMessage(_){var d;return(d=n.tangoRelatedFields)==null?void 0:d.empty},isSearchable:!0,selectedOptionStyle:"check",isLoading:f instanceof A,virtualized:!0},formControlProps:{isDisabled:a||!(f instanceof P)},formControlInnerProps:{label:(R=n.tangoRelatedFields)==null?void 0:R.label},control:i}),f instanceof O&&e.jsx(N,{error:f.errorOrNull().error})]}),e.jsx(r,{children:e.jsx(w,{fieldProps:{name:"username",id:"username",type:"text"},formControlProps:{isDisabled:a},formControlInnerProps:{label:"Nombre de Usuario"},control:i})}),e.jsx(r,{children:e.jsx(Pe,{fieldProps:{name:"password",id:"password"},formControlInnerProps:{label:"Contraseña"},passwordStatus:H,disableForm:a,control:i})}),e.jsx(r,{children:e.jsx(w,{fieldProps:{name:"email",id:"email",type:"text",inputMode:"email"},formControlProps:{isDisabled:a},formControlInnerProps:{label:"Correo electrónico"},control:i})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(x,{})}),e.jsxs(r,{colSpan:{md:2},children:[e.jsx(V,{fieldProps:{name:"perfil_facturacion_id",placeholder:"Seleccione un perfil",options:D,noOptionsMessage(_){return"No hay perfiles disponibles"},isLoading:j instanceof A,selectedOptionStyle:"check"},formControlProps:{isDisabled:a||!(j instanceof P)},control:i,formControlInnerProps:{label:"Perfil de facturación"}}),j instanceof O&&e.jsx(N,{error:j.errorOrNull().error})]}),e.jsx(r,{colSpan:{md:2},children:e.jsx(x,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(g,{size:"sm",textTransform:"uppercase",children:"Estado"})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(_e,{fieldProps:{name:"habilitado_en_dxt",options:[{value:!0,label:"Establecido en Tango"},{value:!1,label:"Deshabilitado"}]},formControlProps:{isDisabled:a},radioProps:{size:{base:"sm",sm:"md"}},control:i})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(x,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(g,{size:"sm",textTransform:"uppercase",children:"Comunicación"})}),e.jsx(r,{children:e.jsx(u,{fieldProps:{name:"mostrar_mensaje_de_advertencia",id:"mostrar_mensaje_de_advertencia"},formControlProps:{width:"auto",isDisabled:a},formControlInnerProps:{label:"Mostrar mensaje de advertencia"},control:i})})]})}),e.jsx(v,{children:e.jsxs(E,{templateColumns:{base:"1fr",md:"repeat(2,1fr)"},alignItems:"start",gap:4,children:[e.jsx(r,{colSpan:{md:2},children:e.jsx(g,{size:"sm",textTransform:"uppercase",children:"Pedidos"})}),e.jsx(r,{colSpan:{md:2},children:e.jsxs(L,{spacing:4,direction:{base:"column"},children:[e.jsx(t,{spacing:4,children:e.jsx(u,{fieldProps:{name:"puede_crear_pedido",id:"puede_crear_pedido"},formControlProps:{width:"auto",isDisabled:a},formControlInnerProps:{label:"Puede crear pedidos"},control:i})}),e.jsx(t,{spacing:4,children:e.jsx(u,{fieldProps:{name:"puede_editar_pedido",id:"puede_editar_pedido"},formControlProps:{width:"auto",isDisabled:a},formControlInnerProps:{label:"Puede editar pedidos"},control:i})}),e.jsx(t,{spacing:4,children:e.jsx(u,{fieldProps:{name:"puede_anular_pedido",id:"puede_anular_pedido"},formControlProps:{width:"auto",isDisabled:a},formControlInnerProps:{label:"Puede anular pedidos"},control:i})}),e.jsx(t,{spacing:4,children:e.jsx(u,{fieldProps:{name:"borrar_pedido_al_anular",id:"borrar_pedido_al_anular"},formControlProps:{width:"auto",isDisabled:a},formControlInnerProps:{label:"Borrar pedido al anular"},control:i,watch:{isDisabled:S===!1,...S===!1&&{isChecked:!1}}})}),e.jsx(t,{spacing:4,children:e.jsx(u,{fieldProps:{name:"aprobar_pedido_al_crear",id:"aprobar_pedido_al_crear"},formControlProps:{width:"auto",isDisabled:a},formControlInnerProps:{label:"Los pedidos se aprueban al crearlos"},control:i})}),e.jsx(t,{spacing:4,children:e.jsx(u,{fieldProps:{name:"ver_pedidos_cumplidos",id:"ver_pedidos_cumplidos"},formControlProps:{width:"auto",isDisabled:a},formControlInnerProps:{label:"Puede ver los pedidos cumplidos"},control:i})}),e.jsx(t,{spacing:4,children:e.jsx(u,{fieldProps:{name:"ver_sin_precio",id:"ver_sin_precio"},formControlProps:{width:"auto",isDisabled:a},formControlInnerProps:{label:"Puede ver artículos sin precios"},control:i})})]})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(x,{})}),e.jsx(r,{children:e.jsx(w,{fieldProps:{name:"dia_de_entrega",id:"dia_de_entrega",type:"number",inputMode:"tel"},formControlProps:{isDisabled:a},formControlInnerProps:{label:"Tiempo de entrega de pedidos",helperText:"Expresado en días"},control:i})}),e.jsx(r,{})]})}),e.jsx(v,{children:e.jsx(ge,{buttonActionText:"Actualizar",isLoading:a})})]})})},Ee=c=>{const{typeSettings:l,id:n}=c,{state:o,retry:m}=l.api.getOne(n);return o.map({loading:p=>e.jsx(ve,{}),error:({error:p})=>e.jsx(de,{error:p,retry:m,cancelAndNavigateTo:k}),success:p=>e.jsx(Ie,{stateData:p.data,typeSettings:l})})};function Sr(){const c=J(),{id:l}=Q(),n=Z.customers;try{if(ee(l))return e.jsxs(e.Fragment,{children:[e.jsx(ne,{title:n.titles.edit,returnButton:{buttonProps:{onClick:()=>{c(U)}}}}),e.jsx(Ee,{typeSettings:n,id:l})]})}catch{return e.jsx(te,{error:ae,buttonProps:{label:ie,colorScheme:"green",onClick:()=>{c(k)}}})}}export{Sr as default};
