import{j as e,r as b,g as he}from"./emotion-element-5486c51c.browser.esm-CMT9BBIk.js";import{u as Se}from"./useDXTApiFetch-D7fvlkDE.js";import{F as Ke,G as Xe,H as Ye,I as Ze,J as Je,K as Qe,L as et,M as tt,N as st,O as rt,Q as nt,o as fe,k as it,l as W,m as ye,T as at,R as ot,S as lt,U as ct,V as dt,W as ht,X as ut,Y as mt,Z as _t,_ as gt,$ as xt,a0 as ft,a1 as pt,a2 as jt,a3 as Et,a4 as Rt}from"./TextPrice-pYuEWncP.js";import{p as Dt,f as B,m as Tt,o as bt,c as ue,I as X,bh as Ot,bi as vt,bj as At,bk as Ct,bl as It,bm as St,U as yt,a2 as Lt,aJ as P,bn as zt,bo as Pt,bp as w,bq as wt,br as Nt,ao as Ft,bs as Mt,bt as kt,bu as Bt,aB as Ht,bv as Ut,bw as $t,bx as Wt,by as Vt,bz as Gt,bA as qt,bB as Kt,g as ie,bC as Xt,am as Yt,n as Le,b7 as Zt,a6 as Jt,x as Qt,aX as ee,ap as es}from"./auth_context-CCfWU2Jo.js";import{S as pe,A as ze}from"./ApiErrors-Blpol96Y.js";import{a as z,F as U}from"./FormSkeletons-Ch1cmlVo.js";import{N as Pe,M as ts,a as ss,b as S,c as te}from"./Navbar-DANenbq-.js";import{O as we,u as rs,d as ns,a as is,m as as,r as os}from"./OrdersContainer-lqr2uFIj.js";import{B as O}from"./chunk-PULVB27S-C1tz_n3L.js";import{G as Y,a as E}from"./chunk-ZPFGWTBB-Bu2gzu07.js";import{u as Ne,S as Fe}from"./SearchField-gbhuOeMX.js";import{P as ls,r as cs,E as M,i as ds,a as je,g as hs,o as Me,b as us}from"./index-BdVeZ32W.js";import{u as ke}from"./app_resources-Di8KxAHS.js";import{J as ms,K as _s,z as gs,M as xs,Q as fs}from"./app-DHK1Xtws.js";import{R as Ee}from"./ResponsiveIconButton-CQwgfxML.js";import{j as ps,i as js}from"./AccountCancelIcon-B2VjX7I2.js";import{A as Es,T as N,u as Rs,C as Re}from"./ConfirmationDialog-B2vV8YvE.js";import{F as Ds}from"./index.esm-CIB2f2-Q.js";import{a as Ts,L as bs,b as De}from"./chunk-46CXQZ4E-CqQSj_hs.js";import{L as Os}from"./chunk-K7XRJ7NL-BmZBywqz.js";import{V as vs}from"./chunk-NTCQBYKE-BqJT1CcA.js";import{F as k}from"./chunk-KRPLQIP4-Duu5zv9H.js";import{H as Te}from"./chunk-3ASUQ6PA-BkEgKCWb.js";import{f as As}from"./chunk-HB6KBUMZ-BghbaEwP.js";import{I as Cs}from"./chunk-6QYXN73V-tPml5wjb.js";import{A as L}from"./chunk-3KCBMPN5-D8G8ZRLu.js";import{A as me,b as _e}from"./chunk-QURMB2UJ-Dpy63TOY.js";import{T as V}from"./chunk-2OOHT3W5-CC38uFWT.js";import{B as Is}from"./chunk-Z6RXEUPO-CxfasoKf.js";import{H as v}from"./chunk-7OLJDQMT-DqhdIuo6.js";import{C as Ss}from"./chunk-CWVAJCXJ-BZwDvuOt.js";import{b as Be,c as He,T as ys,a as Ls}from"./chunk-T2WCTPDH-B3SegIkI.js";import{u as zs}from"./chunk-6RSEZNRH-p2hFl890.js";var[Ps,Ue]=Dt({name:"TagStylesContext",errorMessage:`useTagStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tag />" `}),ae=B((r,t)=>{const s=Tt("Tag",r),n=bt(r),o={display:"inline-flex",verticalAlign:"top",alignItems:"center",maxWidth:"100%",...s.container};return e.jsx(Ps,{value:s,children:e.jsx(ue.span,{ref:t,...n,__css:o})})});ae.displayName="Tag";var oe=B((r,t)=>{const s=Ue();return e.jsx(ue.span,{ref:t,noOfLines:1,...r,__css:s.label})});oe.displayName="TagLabel";var ws=B((r,t)=>e.jsx(X,{ref:t,verticalAlign:"top",marginEnd:"0.5rem",...r}));ws.displayName="TagLeftIcon";var Ns=B((r,t)=>e.jsx(X,{ref:t,verticalAlign:"top",marginStart:"0.5rem",...r}));Ns.displayName="TagRightIcon";var $e=r=>e.jsx(X,{verticalAlign:"inherit",viewBox:"0 0 512 512",...r,children:e.jsx("path",{fill:"currentColor",d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})});$e.displayName="TagCloseIcon";var Fs=B((r,t)=>{const{isDisabled:s,children:n,...o}=r,c={display:"flex",alignItems:"center",justifyContent:"center",outline:"0",...Ue().closeButton};return e.jsx(ue.button,{ref:t,"aria-label":"close",...o,type:"button",disabled:s,__css:c,children:n||e.jsx($e,{})})});Fs.displayName="TagCloseButton";const Ms=()=>e.jsxs(e.Fragment,{children:[e.jsx(Pe,{}),e.jsx(we,{children:e.jsx(O,{width:"full",sx:{mt:8,mb:4},children:e.jsxs(Y,{templateColumns:"1fr",alignItems:"center",gap:4,children:[e.jsx(E,{children:e.jsx(z,{height:"120px"})}),e.jsx(E,{children:e.jsx(z,{height:"120px"})}),e.jsx(E,{children:e.jsx(z,{height:"120px"})}),e.jsx(E,{children:e.jsx(z,{height:"120px"})}),e.jsx(E,{children:e.jsx(z,{height:"120px"})}),e.jsx(E,{children:e.jsx(z,{height:"120px"})})]})})})]});function ks(r){return r&&typeof r=="object"&&"default"in r?r.default:r}var G=ks(b),Bs=Object.assign||function(r){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(r[n]=s[n])}return r},Hs=function(r,t){var s={};for(var n in r)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(r,n)&&(s[n]=r[n]);return s},be=function(t){var s=t.color,n=s===void 0?"currentColor":s,o=t.size,l=o===void 0?24:o;t.children;var c=Hs(t,["color","size","children"]),m="mdi-icon "+(c.className||"");return G.createElement("svg",Bs({},c,{className:m,width:l,height:l,fill:n,viewBox:"0 0 24 24"}),G.createElement("path",{d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"}))},Us=G.memo?G.memo(be):be,$s=Us;const Ws=he($s);let A;typeof window<"u"?A=window:typeof self<"u"?A=self:A=global;let le=null,ce=null;const Oe=20,se=A.clearTimeout,ve=A.setTimeout,re=A.cancelAnimationFrame||A.mozCancelAnimationFrame||A.webkitCancelAnimationFrame,Ae=A.requestAnimationFrame||A.mozRequestAnimationFrame||A.webkitRequestAnimationFrame;re==null||Ae==null?(le=se,ce=function(t){return ve(t,Oe)}):(le=function([t,s]){re(t),se(s)},ce=function(t){const s=Ae(function(){se(n),t()}),n=ve(function(){re(s),t()},Oe);return[s,n]});function Vs(r){let t,s,n,o,l,c,m;const _=typeof document<"u"&&document.attachEvent;if(!_){c=function(u){const g=u.__resizeTriggers__,R=g.firstElementChild,D=g.lastElementChild,C=R.firstElementChild;D.scrollLeft=D.scrollWidth,D.scrollTop=D.scrollHeight,C.style.width=R.offsetWidth+1+"px",C.style.height=R.offsetHeight+1+"px",R.scrollLeft=R.scrollWidth,R.scrollTop=R.scrollHeight},l=function(u){return u.offsetWidth!==u.__resizeLast__.width||u.offsetHeight!==u.__resizeLast__.height},m=function(u){if(u.target.className&&typeof u.target.className.indexOf=="function"&&u.target.className.indexOf("contract-trigger")<0&&u.target.className.indexOf("expand-trigger")<0)return;const g=this;c(this),this.__resizeRAF__&&le(this.__resizeRAF__),this.__resizeRAF__=ce(function(){l(g)&&(g.__resizeLast__.width=g.offsetWidth,g.__resizeLast__.height=g.offsetHeight,g.__resizeListeners__.forEach(function(C){C.call(g,u)}))})};let i=!1,d="";n="animationstart";const a="Webkit Moz O ms".split(" ");let h="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),j="";{const u=document.createElement("fakeelement");if(u.style.animationName!==void 0&&(i=!0),i===!1){for(let g=0;g<a.length;g++)if(u.style[a[g]+"AnimationName"]!==void 0){j=a[g],d="-"+j.toLowerCase()+"-",n=h[g],i=!0;break}}}s="resizeanim",t="@"+d+"keyframes "+s+" { from { opacity: 0; } to { opacity: 0; } } ",o=d+"animation: 1ms "+s+"; "}const f=function(i){if(!i.getElementById("detectElementResize")){const d=(t||"")+".resize-triggers { "+(o||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',a=i.head||i.getElementsByTagName("head")[0],h=i.createElement("style");h.id="detectElementResize",h.type="text/css",r!=null&&h.setAttribute("nonce",r),h.styleSheet?h.styleSheet.cssText=d:h.appendChild(i.createTextNode(d)),a.appendChild(h)}};return{addResizeListener:function(i,d){if(_)i.attachEvent("onresize",d);else{if(!i.__resizeTriggers__){const a=i.ownerDocument,h=A.getComputedStyle(i);h&&h.position==="static"&&(i.style.position="relative"),f(a),i.__resizeLast__={},i.__resizeListeners__=[],(i.__resizeTriggers__=a.createElement("div")).className="resize-triggers";const j=a.createElement("div");j.className="expand-trigger",j.appendChild(a.createElement("div"));const u=a.createElement("div");u.className="contract-trigger",i.__resizeTriggers__.appendChild(j),i.__resizeTriggers__.appendChild(u),i.appendChild(i.__resizeTriggers__),c(i),i.addEventListener("scroll",m,!0),n&&(i.__resizeTriggers__.__animationListener__=function(R){R.animationName===s&&c(i)},i.__resizeTriggers__.addEventListener(n,i.__resizeTriggers__.__animationListener__))}i.__resizeListeners__.push(d)}},removeResizeListener:function(i,d){if(_)i.detachEvent("onresize",d);else if(i.__resizeListeners__.splice(i.__resizeListeners__.indexOf(d),1),!i.__resizeListeners__.length){i.removeEventListener("scroll",m,!0),i.__resizeTriggers__.__animationListener__&&(i.__resizeTriggers__.removeEventListener(n,i.__resizeTriggers__.__animationListener__),i.__resizeTriggers__.__animationListener__=null);try{i.__resizeTriggers__=!i.removeChild(i.__resizeTriggers__)}catch{}}}}}class Gs extends b.Component{constructor(...t){super(...t),this.state={height:this.props.defaultHeight||0,scaledHeight:this.props.defaultHeight||0,scaledWidth:this.props.defaultWidth||0,width:this.props.defaultWidth||0},this._autoSizer=null,this._detectElementResize=null,this._parentNode=null,this._resizeObserver=null,this._timeoutId=null,this._onResize=()=>{this._timeoutId=null;const{disableHeight:s,disableWidth:n,onResize:o}=this.props;if(this._parentNode){const l=window.getComputedStyle(this._parentNode)||{},c=parseFloat(l.paddingLeft||"0"),m=parseFloat(l.paddingRight||"0"),_=parseFloat(l.paddingTop||"0"),f=parseFloat(l.paddingBottom||"0"),x=this._parentNode.getBoundingClientRect(),p=x.height-_-f,i=x.width-c-m,d=this._parentNode.offsetHeight-_-f,a=this._parentNode.offsetWidth-c-m;(!s&&(this.state.height!==d||this.state.scaledHeight!==p)||!n&&(this.state.width!==a||this.state.scaledWidth!==i))&&(this.setState({height:d,width:a,scaledHeight:p,scaledWidth:i}),typeof o=="function"&&o({height:d,scaledHeight:p,scaledWidth:i,width:a}))}},this._setRef=s=>{this._autoSizer=s}}componentDidMount(){const{nonce:t}=this.props,s=this._autoSizer?this._autoSizer.parentNode:null;if(s!=null&&s.ownerDocument&&s.ownerDocument.defaultView&&s instanceof s.ownerDocument.defaultView.HTMLElement){this._parentNode=s;const n=s.ownerDocument.defaultView.ResizeObserver;n!=null?(this._resizeObserver=new n(()=>{this._timeoutId=setTimeout(this._onResize,0)}),this._resizeObserver.observe(s)):(this._detectElementResize=Vs(t),this._detectElementResize.addResizeListener(s,this._onResize)),this._onResize()}}componentWillUnmount(){this._parentNode&&(this._detectElementResize&&this._detectElementResize.removeResizeListener(this._parentNode,this._onResize),this._timeoutId!==null&&clearTimeout(this._timeoutId),this._resizeObserver&&this._resizeObserver.disconnect())}render(){const{children:t,defaultHeight:s,defaultWidth:n,disableHeight:o=!1,disableWidth:l=!1,doNotBailOutOnEmptyChildren:c=!1,nonce:m,onResize:_,style:f={},tagName:x="div",...p}=this.props,{height:i,scaledHeight:d,scaledWidth:a,width:h}=this.state,j={overflow:"visible"},u={};let g=!1;return o||(i===0&&(g=!0),j.height=0,u.height=i,u.scaledHeight=d),l||(h===0&&(g=!0),j.width=0,u.width=h,u.scaledWidth=a),c&&(g=!1),b.createElement(x,{ref:this._setRef,style:{...j,...f},...p},!g&&t(u))}}const qs=r=>{const{isDraft:t,isOpen:s,onClose:n}=r,o=b.useRef(),{state:l,retry:c}=ps(),m=()=>{const{filteredData:_,handleSearchInputChange:f}=Ne(o.current??[],["screen_name"]),x=30,p=({style:i,index:d,data:a})=>{const h=a?.[d];return h!=null?e.jsx(e.Fragment,{children:e.jsx(bs,{style:i,children:h.habilitado?e.jsx(Os,{href:P(t?zt:Pt,{client:h.id}),children:e.jsxs(O,{children:[e.jsx(De,{as:Es,color:"green.400"}),h.screen_name]})}):e.jsxs(O,{color:"gray.400",sx:{cursor:"not-allowed"},children:[e.jsx(De,{as:js,color:"red.400"}),h.screen_name]})},h.id)}):e.jsx(e.Fragment,{})};return e.jsxs(e.Fragment,{children:[e.jsx(O,{sx:{pb:4},children:e.jsx(Fe,{handleSearchInputChange:f})}),e.jsx(Gs,{children:({height:i,width:d})=>e.jsx(Ds,{height:i-60,itemCount:_.length??0,itemSize:x,innerElementType:Ts,width:d,itemData:_,children:p})})]})};return e.jsxs(Ot,{isCentered:!0,isOpen:s,onClose:n,scrollBehavior:"inside",size:{base:"full",sm:"md",md:"lg"},children:[e.jsx(vt,{bg:"blackAlpha.800"}),e.jsxs(At,{sx:{maxHeight:"auto"},children:[e.jsx(Ct,{children:"Seleccione el cliente"}),e.jsx(It,{}),e.jsx(St,{minHeight:{base:"auto",sm:"420px !important"},children:l.map({loading:_=>e.jsxs(vs,{spacing:4,children:[e.jsx(pe,{width:"full",height:"36px",borderRadius:"md"}),e.jsx(pe,{width:"full",height:"250px",borderRadius:"md"})]}),error:({error:_})=>e.jsx(ze,{error:_,retry:c,cancelAndNavigateTo:yt}),success:_=>(o.current=Lt.sortBy(_.data,["screen_name"]),e.jsx(m,{}))})})]})]})},de="setUnsetSelectedPedido",Ks=({isDraft:r,pedidos:t,stateRenglones:s,handleSearchInputChange:n})=>{const o=ke(),[l,c]=b.useState(!1),{isOpen:m,onOpen:_,onClose:f}=rs(),[x,p]=b.useState([]);b.useRef({pedidos:[],renglones:{}}),b.useEffect(()=>{const j=({id:u,checked:g})=>{p(g?R=>[...R,u]:R=>R.filter(D=>D!==u))};return w.on(de,j),()=>{w.removeListener(de,j)}},[]);const i=()=>{if(o.authState.isCustomer()){o.navigate(r?Mt:kt);return}c(!0),_()},d=()=>{f(),c(!1)},a=()=>{Array.isArray(x)&&window.open(`${Bt}?orderId=${x.join("&orderId=")}`,"OrderPrintWindow","width=800,height=600")},h=x.length<=0?void 0:x.length==1?`1 ${ms}`:`${x.length} ${_s}`;return e.jsxs(e.Fragment,{children:[e.jsxs(k,{flex:1,alignItems:"center",justifyContent:"space-between",sx:{mx:4},children:[e.jsxs(Te,{spacing:{base:2,sm:3},alignItems:"center",children:[(o.authState.isSeller()||o.authState.isCustomer())&&e.jsx(e.Fragment,{children:e.jsx(Ee,{icon:Ws,text:r?wt:Nt,sharedProps:{size:"md",fontWeight:"400",colorScheme:r?"deepOrange":"orange",variant:r?"outline":"solid",onClick:()=>{i()},isDisabled:!r&&!o.authState.userInfo.puede_crear_pedido},iconProps:{boxSize:{base:5,md:4}}})}),!r&&e.jsx(Ee,{icon:ls,text:Ft,sharedProps:{size:"md",fontWeight:"400",colorScheme:"blue",onClick:()=>a(),isDisabled:x.length<=0},iconProps:{boxSize:{base:5,md:4}}}),h!=null&&e.jsxs(e.Fragment,{children:[e.jsx(ae,{display:{base:"none",sm:"inherited"},height:8,borderRadius:40,size:"md",variant:"solid",colorScheme:"blue",children:e.jsx(oe,{marginX:1,children:h})}),e.jsx(ae,{display:{base:"inherited",sm:"none"},height:8,borderRadius:40,size:"md",variant:"solid",colorScheme:"blue",children:e.jsx(oe,{marginX:1,children:x.length})})]})]}),e.jsx(k,{alignItems:"center",marginLeft:4,children:e.jsx(Te,{spacing:{base:2,md:4},children:e.jsx(O,{children:e.jsx(Fe,{handleSearchInputChange:n})})})})]}),l&&e.jsx(qs,{isDraft:r,isOpen:m,onClose:d})]})};function Xs(r){return r&&typeof r=="object"&&"default"in r?r.default:r}var q=Xs(b),Ys=Object.assign||function(r){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(r[n]=s[n])}return r},Zs=function(r,t){var s={};for(var n in r)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(r,n)&&(s[n]=r[n]);return s},Ce=function(t){var s=t.color,n=s===void 0?"currentColor":s,o=t.size,l=o===void 0?24:o;t.children;var c=Zs(t,["color","size","children"]),m="mdi-icon "+(c.className||"");return q.createElement("svg",Ys({},c,{className:m,width:l,height:l,fill:n,viewBox:"0 0 24 24"}),q.createElement("path",{d:"M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"}))},Js=q.memo?q.memo(Ce):Ce,Qs=Js;const er=he(Qs);function tr(r,t){return t.isSuccess()?cs(r,t.data[r.id]):r.estado}function We(r,t){let s;switch(r){case M.INGRESADO:s="blue";break;case M.APROBADO:s="purple";break;case M.CUMPLIDO:s="green";break;case M.CERRADO:s="black";break;case M.ANULADO:s="red";break;default:s="gray"}return t==null?s:`${s}${t}`}function sr(r){return r&&typeof r=="object"&&"default"in r?r.default:r}var K=sr(b),rr=Object.assign||function(r){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(r[n]=s[n])}return r},nr=function(r,t){var s={};for(var n in r)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(r,n)&&(s[n]=r[n]);return s},Ie=function(t){var s=t.color,n=s===void 0?"currentColor":s,o=t.size,l=o===void 0?24:o;t.children;var c=nr(t,["color","size","children"]),m="mdi-icon "+(c.className||"");return K.createElement("svg",rr({},c,{className:m,width:l,height:l,fill:n,viewBox:"0 0 24 24"}),K.createElement("path",{d:"M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z"}))},ir=K.memo?K.memo(Ie):Ie,ar=ir;const or=he(ar),lr=({app:r,isDraft:t,pedido:s,onDelete:n,onMarkAsFavorite:o})=>{const l=r.authState.userInfo,c=r.authState.isAdmin(),m=t&&s.es_favorito,_=!c&&(t||l.puede_crear_pedido),f=!c&&t&&l.puede_crear_pedido,x=!c&&!t,p=!c&&(t||l.puede_editar_pedido&&ds(l,s.estado)),i=!m&&(t||je(l,s.estado)),d=t||l.borrar_pedido_al_anular,a=[];p&&a.push(e.jsx(S,{onClick:()=>{r.navigate(P(t?Ut:$t,{id:s.id}))},children:Ke},a.length)),_&&a.push(e.jsx(S,{onClick:()=>{r.navigate(P(t?Wt:Vt,{id:s.id}))},children:Xe},a.length)),f&&a.push(e.jsx(S,{onClick:()=>{r.navigate(P(Gt,{id:s.id}))},children:m?Ye:Ze},a.length)),x&&a.push(e.jsx(S,{onClick:()=>{r.navigate(P(qt,{id:s.id}))},children:Je},a.length)),t&&!m&&(f&&a.push(e.jsx(S,{onClick:()=>{r.navigate(P(Kt,{id:s.id}))},children:Qe},a.length)),a.length>0&&a.push(e.jsx(te,{},a.length)),a.push(e.jsx(S,{onClick:()=>o(s.id,!0),children:et},a.length))),m&&(a.length>0&&a.push(e.jsx(te,{},a.length)),a.push(e.jsx(S,{onClick:()=>o(s.id,!1),children:tt},a.length))),(t||je(l,s.estado))&&(a.length>0&&a.push(e.jsx(te,{},a.length)),a.push(e.jsx(S,{onClick:()=>n(s.id),isDisabled:m||!i,children:m?st:d?rt:nt},a.length)));const h=a.length==0;return e.jsxs(As,{isLazy:!0,id:"menu",children:[e.jsx(ts,{as:Cs,size:"sm","aria-label":gs,icon:e.jsx(or,{}),variant:"outline",colorScheme:"white",isDisabled:h}),e.jsx(Ht,{children:e.jsx(ss,{rootProps:{zIndex:2e3},children:a})})]})},cr=()=>e.jsxs(L,{status:"warning",children:[e.jsx(me,{}),e.jsx(_e,{children:"El pedido no cuenta con productos."})]}),dr=()=>e.jsxs(L,{status:"error",children:[e.jsx(me,{}),e.jsx(_e,{children:"Ocurrió un error al cargar los detalles del pedido."})]}),hr=()=>e.jsx(O,{width:"full",sx:{mt:8,mb:4},children:e.jsxs(Y,{templateColumns:"1fr",alignItems:"center",gap:2,children:[e.jsx(E,{children:e.jsx(U,{height:"20px"})}),e.jsx(E,{children:e.jsx(U,{height:"20px"})}),e.jsx(E,{children:e.jsx(U,{height:"20px"})}),e.jsx(E,{children:e.jsx(U,{height:"20px"})})]})}),ur=({pedido:r,renglones:t,esCliente:s})=>{const n=ie("var(--chakra-colors-gray-200)","var(--chakra-colors-black)"),o=ie("var(--chakra-colors-gray-400)","var(--chakra-colors-black)"),{numero_pedido:l,descuento:c}=r,m=c>0||!s;return e.jsxs("table",{width:"100%",cellPadding:8,cellSpacing:4,style:{fontSize:"0.8rem",border:`1px solid ${o}`},children:[e.jsx("thead",{style:{backgroundColor:`${n}`,textTransform:"uppercase"},children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left",style:{width:m?"60%":"70%"},children:"Artículo"}),e.jsx("th",{className:"text-right hidden-on-base",style:{width:"10%"},children:"Precio"}),m&&e.jsx("th",{className:"text-right hidden-on-mobile",style:{width:"10%"},children:"Bonificado"}),e.jsx("th",{className:"text-center",style:{width:"10%"},children:"Cantidad"}),e.jsx("th",{className:"text-right",style:{width:"10%"},children:"Subtotal"})]})}),e.jsx("tbody",{children:t.map(({id_articulo:_,nombre_articulo:f,codigo_articulo:x,descripcion_adicional:p,precio:i,cantidad:d,es_precio_especial:a},h)=>{const j=i!=null?i*d:null,u=fe(i,c),g=fe(j,c);return e.jsxs("tr",{style:{color:i==null?"red":void 0},children:[e.jsx("td",{children:e.jsx(N,{children:it(f,x,p)})}),e.jsx("td",{className:"text-right hidden-on-base",children:a&&i!=null?"Especial":e.jsx(W,{precio:i,moneda:"$"})}),m&&e.jsx("td",{className:"text-right hidden-on-mobile",children:e.jsx(W,{precio:u,moneda:"$"})}),e.jsx("td",{children:e.jsx(V,{textAlign:"center",children:d})}),e.jsx("td",{className:"text-right",children:e.jsx(W,{precio:g,moneda:"$"})})]},`details-${l}-${h}`)})})]})},mr=({wasOpen:r,pedido:t,stateRenglones:s,esCliente:n})=>e.jsx(O,{sx:{mt:6},children:r&&s.map({loading:o=>e.jsx(hr,{}),error:o=>e.jsx(dr,{}),success:o=>{const{id:l}=t,c=o.data?.[l];return Array.isArray(c)?e.jsx(ur,{pedido:t,renglones:c,esCliente:n}):e.jsx(cr,{})}})}),_r=({estado:r})=>{const t=hs(r),s=We(r);return e.jsx(Is,{fontSize:"1em",variant:"solid",colorScheme:s,lineHeight:"1.5em",children:t})},$=r=>{const{children:t}=r;return e.jsx(k,{direction:{base:"row",lg:"column"},gap:4,children:t})},y=r=>{const{children:t}=r;return e.jsx(k,{direction:"column",flex:1,children:t})};function Ve({total:r,descuento:t,taxesLabel:s}){const n=`TOTAL ${t>0?`-${t}%`:""}`;return e.jsxs(y,{children:[e.jsxs(v,{size:"sm",sx:{textTransform:"uppercase",whiteSpace:"normal"},children:[e.jsx("div",{children:n}),e.jsx("div",{children:s})]}),e.jsx(v,{size:"md",sx:{fontWeight:"bolder"},children:r!=null&&e.jsx(W,{precio:r,moneda:"$"})})]})}const gr=r=>{const{app:t,pedido:s,total:n,estado:o,handleToggleDetails:l}=r,{numero_pedido:c,fecha_hora_ingreso:m,fecha_entrega:_,codigo_cliente:f,codigo_vendedor:x,codigo_transporte:p,nombre_cliente:i,nombre_vendedor:d,nombre_transporte:a,descuento:h,mensaje_interno:j,leyenda1:u,leyenda2:g,leyenda3:R,leyenda4:D,leyenda5:C,cliente_exento_iva:T,cliente_exento_ii:I}=s,F=t.authState.isSeller(),Z=t.authState.isAdmin(),H=Me(u,g,R,D,C),ge=H.length>0,J=j!=null&&j.length>0,Q=!T&&!I?"":`${ye(T,I)}`;return e.jsxs(Y,{templateColumns:{base:"repeat(1, 1fr)",lg:"repeat(4, 1fr)"},gap:4,sx:{cursor:"pointer"},onClick:()=>{l()},children:[e.jsx(E,{children:e.jsxs($,{children:[e.jsxs(y,{children:[e.jsx(v,{size:"sm",children:"Pedido"}),e.jsx(V,{children:c})]}),e.jsxs(y,{children:[e.jsx(v,{size:"sm",children:"Estado"}),e.jsx(O,{children:e.jsx(_r,{estado:o})})]})]})}),e.jsx(E,{children:e.jsxs($,{children:[e.jsxs(y,{children:[e.jsx(v,{size:"sm",children:"Ingreso"}),e.jsx(V,{children:Xt(m)})]}),_!=null&&e.jsxs(y,{children:[e.jsx(v,{size:"sm",children:"Entrega"}),e.jsx(V,{children:Yt(_)})]})]})}),(Z||F)&&e.jsx(E,{children:e.jsxs($,{children:[e.jsxs(y,{children:[e.jsxs(v,{size:"sm",children:["Cliente ",f]}),e.jsx(N,{children:i})]}),!F&&e.jsxs(y,{children:[e.jsxs(v,{size:"sm",children:["Vendedor ",x]}),e.jsx(N,{children:d})]})]})}),e.jsx(E,{children:e.jsxs($,{children:[e.jsxs(y,{children:[e.jsxs(v,{size:"sm",children:["Transporte ",p]}),e.jsx(N,{children:a})]}),e.jsx(Ve,{total:n,descuento:h,taxesLabel:Q})]})}),ge&&e.jsx(E,{colSpan:{lg:4},children:e.jsx(L,{status:"warning",sx:{flexDirection:"column",alignItems:"flex-start",bgColor:"yellow.300"},children:H.map((Ge,qe)=>e.jsx(O,{sx:{whiteSpace:"normal",marginBottom:1},children:Ge.v},qe))})}),J&&e.jsx(E,{colSpan:{lg:4},children:e.jsx(L,{status:"info",sx:{flexDirection:"column",alignItems:"flex-start",whiteSpace:"normal"},children:Le(j)})})]})},xr=r=>{const{app:t,pedido:s,estado:n,total:o,handleToggleDetails:l}=r,{codigo_cliente:c,codigo_vendedor:m,codigo_transporte:_,nombre_cliente:f,nombre_vendedor:x,nombre_transporte:p,descuento:i,descripcion:d,leyenda1:a,leyenda2:h,leyenda3:j,leyenda4:u,leyenda5:g,es_favorito:R,mensaje_interno:D,cliente_exento_iva:C,cliente_exento_ii:T}=s;t.authState.isSeller();const I=t.authState.isCustomer(),F=Me(a,h,j,u,g),Z=F.length>0,H=D!=null&&D.length>0,J=!C&&!T?"":`(${ye(C,T)})`;return e.jsxs(Y,{templateColumns:{base:"repeat(1, 1fr)",md:"repeat(2, 1fr)",lg:"repeat(3, 1fr)"},gap:6,sx:{cursor:"pointer"},onClick:()=>{l()},children:[e.jsx(E,{colSpan:{lg:3,md:2},children:e.jsx(v,{size:"md",textTransform:"uppercase",children:d})}),!I&&e.jsxs(E,{children:[e.jsxs(v,{size:"sm",children:["Cliente ",c]}),e.jsx(N,{children:f})]}),e.jsxs(E,{children:[e.jsxs(v,{size:"sm",children:["Transporte ",_]}),e.jsx(N,{children:p})]}),e.jsx(Ve,{total:o,descuento:i,taxesLabel:J}),Z&&e.jsx(E,{colSpan:{lg:3,md:2},children:e.jsx(L,{status:"warning",sx:{flexDirection:"column",alignItems:"flex-start",bgColor:"yellow.300"},children:F.map((xe,Q)=>e.jsx(O,{sx:{whiteSpace:"normal",marginBottom:1},children:xe.v},Q))})}),H&&e.jsx(E,{colSpan:{lg:3,md:2},children:e.jsx(L,{status:"info",sx:{flexDirection:"column",alignItems:"flex-start",whiteSpace:"normal"},children:Le(D)})})]})};function fr(r,t){return t.isSuccess()?us(r,t.data[r.id]):null}const ne="togglePedidoDetails",pr=({index:r,app:t,draft:s,pedido:n,stateRenglones:o,handleDelete:l,handleMarkAsFavorite:c,isHidden:m})=>{const[_,f]=b.useState(!1),[x,p]=b.useState(!1),i=ie("gray.800","white"),d=b.useRef(!1),a=tr(n,o),h=n.total!=null?n.total:fr(n,o),j=b.useMemo(()=>e.jsx(mr,{wasOpen:d.current,pedido:n,stateRenglones:o,esCliente:t.authState.isCustomer()}),[d.current,o.constructor.name]),u=()=>{const T=!_;T&&(d.current=!0),f(T),w.emit(ne,{id:n.id})},g=(T,I)=>{p(!!T),w.emit(de,{id:I,checked:T})};b.useEffect(()=>{const T=({id:I})=>{n.id!==I&&f(!1)};return w.on(ne,T),()=>{w.removeListener(ne,T)}},[]);const{id:R,es_favorito:D}=n,C=s&&D;return e.jsx(Be,{sx:{...m&&!x&&{display:"none"}},children:e.jsxs(He,{sx:{py:6,position:"relative",borderTopWidth:s?void 0:{base:"5px",md:"5px"},borderTopStyle:s?void 0:"solid",borderTopColor:s?void 0:We(a,".500 !important"),borderWidth:s?{base:"4px",md:"4px"}:void 0,borderStyle:s?"dashed":void 0,borderColor:s?D?"orange.500 !important":"blue.500 !important":void 0},children:[e.jsxs(O,{display:"flex",sx:{position:"absolute",right:2,top:5},flexDirection:"column",children:[e.jsx(lr,{app:t,isDraft:s,pedido:n,onDelete:l,onMarkAsFavorite:c}),C&&e.jsx(k,{backgroundColor:"orange",justifyContent:"center",alignItems:"center",sx:{mt:2,borderRadius:4,aspectRatio:1},children:e.jsx(X,{as:er,boxSize:4,color:"white"})}),!s&&e.jsx(Ss,{size:"xl",colorScheme:"blue",sx:{mt:2,borderWidth:0,borderColor:i,backgroundColor:"white"},onChange:T=>{g(T.target.checked,R)}})]}),s?e.jsx(xr,{app:t,pedido:n,estado:a,total:h,handleToggleDetails:u}):e.jsx(gr,{app:t,pedido:n,estado:a,total:h,handleToggleDetails:u}),e.jsx(O,{children:e.jsx(O,{sx:{display:_?"block":"none"},children:j})},`pedido-details-${r}`)]})})};function jr(r){const t=ke(),n=t.authState.userInfo.borrar_pedido_al_anular.valueOf(),{draft:o,unfilteredPedidos:l,filteredPedidos:c,isFiltering:m,stateRenglones:_,reloadData:f}=r,x=zs(),p=Rs(),i=async a=>{if(await p({title:o?ot:n?lt:ct,message:o?dt:n?ht:ut})==Re.accept){const j=o?await ns(a,t):await is(a,t);j.map({success:u=>{x({title:o?mt:n?_t:gt,status:"success"})},error:u=>{x({title:u.errorInfoOrNull()?.error_description??Jt,status:"error"})}}),j.isSuccess()&&await f()}},d=async(a,h)=>{if(h){(await as(a,t)).isSuccess()&&await f();return}await p({title:xt,message:ft})==Re.accept&&(await os(a,t)).isSuccess()&&await f()};return e.jsx(at,{sx:{p:0,m:0},children:e.jsx(ys,{variant:"stripedOverCard",colorScheme:"gray",size:"md",sx:{borderCollapse:"separate",borderSpacing:"0 1rem"},children:e.jsxs(Ls,{children:[l.map((a,h)=>e.jsx(pr,{index:h,draft:o,app:t,pedido:a,stateRenglones:_,handleDelete:i,handleMarkAsFavorite:d,isHidden:m&&!c.includes(a)},`pedido-${a.id}`)),!c.length&&e.jsx(Be,{children:e.jsx(He,{children:e.jsxs(L,{status:"info",children:[e.jsx(me,{}),e.jsx(_e,{children:m?Zt:o?xs:fs})]})})})]})})})}const Er=r=>{const{showDrafts:t,pedidos:s,reloadData:n}=r,o=Qt().state.userOrThrow(),l=o.role==ee.admin;o.role==ee.seller;const c=o.role==ee.customer,{filteredData:m,handleSearchInputChange:_,isFiltering:f}=Ne(s,["descripcion","comentarios",...t?[]:["numero_pedido"],...c?[]:["codigo_cliente","nombre_cliente"],...l?["codigo_vendedor","nombre_vendedor"]:[]]),{state:x}=Se({...t?pt:jt,silent:!0,transformResponse:p=>(Object.values(p).forEach(i=>{Array.isArray(i)&&i.sort((d,a)=>d.renglon-a.renglon)}),p)});return e.jsxs(e.Fragment,{children:[e.jsx(Pe,{children:e.jsx(Ks,{isDraft:t,pedidos:s,stateRenglones:x,handleSearchInputChange:_})}),e.jsx(we,{children:e.jsx(jr,{draft:t,stateRenglones:x,unfilteredPedidos:s,filteredPedidos:m,isFiltering:f,reloadData:n})})]})},sn=r=>{const t=r.showDrafts===!0,{state:s,retry:n,reload:o}=Se({...t?Et:Rt,silent:!0});return s.map({loading:l=>e.jsx(Ms,{}),error:({error:l})=>e.jsx(ze,{error:l,retry:n,cancelAndNavigateTo:es}),success:l=>{const c=t?l.data.sort(Rr):l.data.sort(Dr);return e.jsx(Er,{showDrafts:t,pedidos:c,reloadData:o})}})};function Rr(r,t){const s=r.es_favorito?1:0,n=t.es_favorito?1:0,o=s-n;if(o!=0)return o;const l=new Date(r.fecha_hora_ingreso).getTime();return new Date(t.fecha_hora_ingreso).getTime()-l}function Dr(r,t){const s=r.estado-t.estado;if(s!=0)return s;const n=r.numero_pedido,o=t.numero_pedido;return n.localeCompare(o)}export{sn as O};
