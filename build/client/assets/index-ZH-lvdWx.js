import{j as e,r as w}from"./emotion-element-43c6fea0.browser.esm-Bukkp3pI.js";import{_ as K,I as Y,Q as Z,U as ee}from"./auth_context-D8ug2Qcd.js";import{A as re}from"./ApiErrors-DeZcFLHr.js";import{F as s}from"./FormSkeletons-D_WNCpXW.js";import{G as T,a as r}from"./chunk-ZPFGWTBB-qFhw8OhE.js";import{H as n}from"./chunk-3ASUQ6PA-BAcdPhwD.js";import{S as z}from"./chunk-ZHMYA64R-D24w8AgT.js";import{a as M,d as se}from"./app-B420985G.js";import{D as u}from"./chunk-W7WUSNWJ-DDHZDhn1.js";import{c as ae}from"./validation-BHlFUWUY.js";import{d as oe,V as ie,P as ne}from"./PasswordWithStatus-DKSTs8vM.js";import{y as de}from"./utils-DihYaFf6.js";import{c as te,a as le}from"./index.esm-DLycO5Xl.js";import{a as ce,o as pe}from"./yup-BdZyDz3M.js";import{a as C,F as O,b as L}from"./useDXTApiFetch-BjHmfZbr.js";import{A as me}from"./AccountCancelIcon-BwrrLNSn.js";import{A as ue,a as xe,C as je,b as m,c as fe}from"./ControlledSwitch-BYzMyLCt.js";import{u as _e,a as he}from"./app_resources-CEgZe0CK.js";import{u as U,C as N}from"./ControlledSelect-fjUlVCrq.js";import{C as E}from"./CommonCard-C2byJLAu.js";import{C as v}from"./ControlledInput-BWCaGqUR.js";import{F as be}from"./FormErrors-BaCwbtS0.js";import{I as G}from"./InlineError-rXH3I37w.js";import{S as Pe}from"./SettingsFormButtons-CthONgBp.js";import{H as I}from"./chunk-7OLJDQMT-W4l9hI3h.js";function We(c,l){try{return c().valueOf()}catch{}return l}const Se=()=>e.jsx(M,{width:"full",sx:{mt:8,mb:4},children:e.jsxs(T,{templateColumns:{base:"1fr",md:"repeat(2,1fr)"},alignItems:"center",gap:4,children:[e.jsx(r,{colSpan:{md:2},children:e.jsx(s,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(u,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(s,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(s,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(u,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(s,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(s,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(u,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(s,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsxs(z,{spacing:4,direction:{base:"column"},children:[e.jsx(n,{spacing:4,children:e.jsx(s,{})}),e.jsx(n,{spacing:4,children:e.jsx(s,{})}),e.jsx(n,{spacing:4,children:e.jsx(s,{})}),e.jsx(n,{spacing:4,children:e.jsx(s,{})}),e.jsx(n,{spacing:4,children:e.jsx(s,{})}),e.jsx(n,{spacing:4,children:e.jsx(s,{})}),e.jsx(n,{spacing:4,children:e.jsx(s,{})}),e.jsx(n,{spacing:4,children:e.jsx(s,{})})]})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(u,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})}),e.jsx(r,{children:e.jsx(s,{})})]})}),ge=()=>{const[c,l]=w.useState(null),t=te({password:le().test("password","Formato de contraseña no válido",p=>{if(p!=null&&p!=""){let a=oe(p);return K.isEqual(c,a)||l(a),de(ie,p)}return l(null),!0})}).required();return{yupValidationSchema:ae.concat(t),passwordStatus:c}},Ce=c=>{var R,V;const{stateData:l,typeSettings:t,returnUrl:b,title:p}=c,a={...l},P=_e(),x=he(),{yupValidationSchema:k,passwordStatus:H}=ge(),{state:j,result:y}=U({endpoint:fe,fieldsMap:{label:"name",value:"id"}}),{state:f,result:A}=U({endpoint:t.userType==="cliente"?ue:xe,fieldsMap:{label:"screen_name",value:"id",isEnabled:"habilitado"},disabledIcon:e.jsx(Y,{as:me,color:"red.400",ml:2,boxSize:5})}),{handleSubmit:B,control:i,resetField:D,setError:X,watch:q,formState:{errors:$,isSubmitting:Q,isSubmitSuccessful:W}}=ce({defaultValues:{username:a.username,email:a.email??"",habilitado_en_dxt:a.habilitado_en_dxt,puede_crear_pedido:a.puede_crear_pedido,puede_editar_pedido:a.puede_anular_pedido,ver_pedidos_cumplidos:a.ver_pedidos_cumplidos,ver_sin_precio:a.ver_sin_precio,mostrar_mensaje_de_advertencia:a.mostrar_mensaje_de_advertencia,puede_anular_pedido:a.puede_anular_pedido,borrar_pedido_al_anular:a.borrar_pedido_al_anular,aprobar_pedido_al_crear:a.aprobar_pedido_al_crear,dia_de_entrega:a.dia_de_entrega},resolver:pe(k)}),S=q("puede_anular_pedido");w.useEffect(()=>{S===!1&&D("borrar_pedido_al_anular",{defaultValue:!1})},[S]),w.useEffect(()=>{var _,d;if(f instanceof C){const h=((_=A.find(g=>g.value===a.tango_id))==null?void 0:_.value)??void 0;D("tango_id",{defaultValue:h})}if(j instanceof C){const h=((d=y.find(g=>g.value===a.perfil_facturacion_id))==null?void 0:d.value)??void 0;D("perfil_facturacion_id",{defaultValue:h})}},[f,j]);const o=W||Q,J=async _=>{const{...d}=_;d.email===""&&delete d.email,d.password===""&&delete d.password;const h=d;(await t.api.patch(a.id,h,P)).map({success:F=>{x({title:se,status:"success"}),P.navigate(b)},error:F=>{x({title:Z,status:"error"}),X("root",{message:F.info.error_description})}})};return e.jsx("form",{noValidate:!0,onSubmit:B(J),children:e.jsxs(M,{children:[e.jsx(be,{errors:$}),e.jsx(E,{children:e.jsxs(T,{templateColumns:{base:"1fr",md:"repeat(2,1fr)"},alignItems:"start",gap:4,children:[e.jsx(r,{colSpan:{md:2},children:e.jsx(I,{size:"sm",textTransform:"uppercase",children:p})}),e.jsxs(r,{colSpan:{md:2},children:[e.jsx(N,{fieldProps:{name:"tango_id",placeholder:(R=t.tangoRelatedFields)==null?void 0:R.placeholder,options:A,noOptionsMessage(_){var d;return(d=t.tangoRelatedFields)==null?void 0:d.empty},isSearchable:!0,selectedOptionStyle:"check",isLoading:f instanceof O,virtualized:!0},formControlProps:{isDisabled:o||!(f instanceof C)},formControlInnerProps:{label:(V=t.tangoRelatedFields)==null?void 0:V.label},control:i}),f instanceof L&&e.jsx(G,{error:f.errorOrNull().error})]}),e.jsx(r,{children:e.jsx(v,{fieldProps:{name:"username",id:"username",type:"text"},formControlProps:{isDisabled:o},formControlInnerProps:{label:"Nombre de Usuario"},control:i})}),e.jsx(r,{children:e.jsx(ne,{fieldProps:{name:"password",id:"password"},formControlInnerProps:{label:"Contraseña"},passwordStatus:H,disableForm:o,control:i})}),e.jsx(r,{children:e.jsx(v,{fieldProps:{name:"email",id:"email",type:"text",inputMode:"email"},formControlProps:{isDisabled:o},formControlInnerProps:{label:"Correo electrónico"},control:i})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(u,{})}),e.jsxs(r,{colSpan:{md:2},children:[e.jsx(N,{fieldProps:{name:"perfil_facturacion_id",placeholder:"Seleccione un perfil",options:y,noOptionsMessage(_){return"No hay perfiles disponibles"},isLoading:j instanceof O,selectedOptionStyle:"check"},formControlProps:{isDisabled:o||!(j instanceof C)},control:i,formControlInnerProps:{label:"Perfil de facturación"}}),j instanceof L&&e.jsx(G,{error:j.errorOrNull().error})]}),e.jsx(r,{colSpan:{md:2},children:e.jsx(u,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(I,{size:"sm",textTransform:"uppercase",children:"Estado"})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(je,{fieldProps:{name:"habilitado_en_dxt",options:[{value:!0,label:"Establecido en Tango"},{value:!1,label:"Deshabilitado"}]},formControlProps:{isDisabled:o},radioProps:{size:{base:"sm",sm:"md"}},control:i})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(u,{})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(I,{size:"sm",textTransform:"uppercase",children:"Comunicación"})}),e.jsx(r,{children:e.jsx(m,{fieldProps:{name:"mostrar_mensaje_de_advertencia",id:"mostrar_mensaje_de_advertencia"},formControlProps:{width:"auto",isDisabled:o},formControlInnerProps:{label:"Mostrar mensaje de advertencia"},control:i})})]})}),e.jsx(E,{children:e.jsxs(T,{templateColumns:{base:"1fr",md:"repeat(2,1fr)"},alignItems:"start",gap:4,children:[e.jsx(r,{colSpan:{md:2},children:e.jsx(I,{size:"sm",textTransform:"uppercase",children:"Pedidos"})}),e.jsx(r,{colSpan:{md:2},children:e.jsxs(z,{spacing:4,direction:{base:"column"},children:[e.jsx(n,{spacing:4,children:e.jsx(m,{fieldProps:{name:"puede_crear_pedido",id:"puede_crear_pedido"},formControlProps:{width:"auto",isDisabled:o},formControlInnerProps:{label:"Puede crear pedidos"},control:i})}),e.jsx(n,{spacing:4,children:e.jsx(m,{fieldProps:{name:"puede_editar_pedido",id:"puede_editar_pedido"},formControlProps:{width:"auto",isDisabled:o},formControlInnerProps:{label:"Puede editar pedidos"},control:i})}),e.jsx(n,{spacing:4,children:e.jsx(m,{fieldProps:{name:"puede_anular_pedido",id:"puede_anular_pedido"},formControlProps:{width:"auto",isDisabled:o},formControlInnerProps:{label:"Puede anular pedidos"},control:i})}),e.jsx(n,{spacing:4,children:e.jsx(m,{fieldProps:{name:"borrar_pedido_al_anular",id:"borrar_pedido_al_anular"},formControlProps:{width:"auto",isDisabled:o},formControlInnerProps:{label:"Borrar pedido al anular"},control:i,watch:{isDisabled:S===!1,...S===!1&&{isChecked:!1}}})}),e.jsx(n,{spacing:4,children:e.jsx(m,{fieldProps:{name:"aprobar_pedido_al_crear",id:"aprobar_pedido_al_crear"},formControlProps:{width:"auto",isDisabled:o},formControlInnerProps:{label:"Los pedidos se aprueban al crearlos"},control:i})}),e.jsx(n,{spacing:4,children:e.jsx(m,{fieldProps:{name:"ver_pedidos_cumplidos",id:"ver_pedidos_cumplidos"},formControlProps:{width:"auto",isDisabled:o},formControlInnerProps:{label:"Puede ver los pedidos cumplidos"},control:i})}),e.jsx(n,{spacing:4,children:e.jsx(m,{fieldProps:{name:"ver_sin_precio",id:"ver_sin_precio"},formControlProps:{width:"auto",isDisabled:o},formControlInnerProps:{label:"Puede ver artículos sin precio"},control:i})})]})}),e.jsx(r,{colSpan:{md:2},children:e.jsx(u,{})}),e.jsx(r,{children:e.jsx(v,{fieldProps:{name:"dia_de_entrega",id:"dia_de_entrega",type:"number",inputMode:"tel"},formControlProps:{isDisabled:o},formControlInnerProps:{label:"Tiempo de entrega de pedidos",helperText:"Expresado en días"},control:i})}),e.jsx(r,{})]})}),e.jsx(E,{children:e.jsx(Pe,{isLoading:o,hideCancelButton:!0})})]})})},Je=c=>{const{typeSettings:l,id:t,returnUrl:b,title:p}=c,{state:a,retry:P}=l.api.getOne(t);return a.map({loading:x=>e.jsx(Se,{}),error:({error:x})=>e.jsx(re,{error:x,retry:P,cancelAndNavigateTo:ee}),success:x=>e.jsx(Ce,{stateData:x.data,typeSettings:l,returnUrl:b,title:p})})};export{Je as D,We as t};
