import{j as e,r as O,g as ue}from"./emotion-element-43c6fea0.browser.esm-CqNy1Myq.js";import{u as Se}from"./useDXTApiFetch-CRKnsto2.js";import{F as Xe,G as Ye,H as Ze,I as Je,J as Qe,K as et,L as tt,M as st,N as rt,O as nt,Q as it,o as fe,k as at,l as W,m as ye,T as ot,R as lt,S as ct,U as dt,V as ht,W as ut,X as mt,Y as _t,Z as gt,_ as xt,$ as ft,a0 as pt,a1 as jt,a2 as Et,a3 as Rt,a4 as Dt}from"./TextPrice-BlyUi6VX.js";import{f as F,u as Tt,o as Le,c as X,d as Ot,p as bt,m as vt,I as Y,be as At,bf as Ct,bg as It,bh as St,bi as yt,bj as Lt,U as zt,_ as Pt,aI as P,bk as wt,bl as Nt,bm as w,bn as Ft,bo as kt,am as Mt,bp as Ht,bq as Bt,br as Ut,aA as $t,bs as Wt,bt as Vt,bu as Gt,bv as qt,bw as Kt,bx as Xt,by as Yt,g as ae,bz as Zt,ak as Jt,b6 as Qt,$ as es,ac as ts,aU as te,an as ss}from"./auth_context-D_Ll0_5_.js";import{S as pe,A as ze}from"./ApiErrors-DYa22bq7.js";import{a as z,F as U}from"./FormSkeletons-aHE8cQ3L.js";import{N as Pe,M as rs,a as ns,b as S,c as se}from"./Navbar-DA6Gr_Uw.js";import{O as we,u as is,d as as,a as os,m as ls,r as cs}from"./OrdersContainer-DJxBauXL.js";import{B as b}from"./chunk-PULVB27S-DN5G48t9.js";import{G as Z,a as E}from"./chunk-ZPFGWTBB-QYQNJcG8.js";import{u as Ne,S as Fe}from"./SearchField-CC5TjVH8.js";import{P as ds,r as hs,E as M,i as us,a as je,g as ms,o as ke,b as _s}from"./index-BbUF8q4R.js";import{u as Me}from"./app_resources-CMr1JJak.js";import{H as gs,J as xs,x as fs,K as ps,M as js}from"./app-BNjwh-R8.js";import{R as Ee}from"./ResponsiveIconButton-z_2CCcCn.js";import{j as Es,i as Rs}from"./AccountCancelIcon-rrxYNRXS.js";import{A as Ds,T as N,u as Ts,C as Re}from"./ConfirmationDialog-IuDo8O1K.js";import{F as Os}from"./index.esm-C8D_c1EJ.js";import{a as bs,L as vs,b as De}from"./chunk-46CXQZ4E-DkrYgWvl.js";import{V as As}from"./chunk-NTCQBYKE-DOyCWGPB.js";import{F as H}from"./chunk-KRPLQIP4-GMYj1Snt.js";import{H as Te}from"./chunk-3ASUQ6PA-D--F2Rh3.js";import{f as Cs}from"./chunk-HB6KBUMZ-Cu1NJnhZ.js";import{I as Is}from"./chunk-6QYXN73V-IdqMEN3a.js";import{A as L}from"./chunk-3KCBMPN5-CX7IG-95.js";import{A as me,b as _e}from"./chunk-QURMB2UJ-MVBYS5yc.js";import{T as V}from"./chunk-2OOHT3W5-rJYDzyIb.js";import{B as Ss}from"./chunk-Z6RXEUPO-BvbrEgsC.js";import{H as v}from"./chunk-7OLJDQMT-BT6Zjs5s.js";import{C as ys}from"./chunk-CWVAJCXJ-DdQwH2U9.js";import{b as He,c as Be,T as Ls,a as zs}from"./chunk-T2WCTPDH-BFKgSPN_.js";import{u as Ps}from"./chunk-6RSEZNRH-Buq0qYbG.js";var Ue=F(function(t,s){const n=Tt("Link",t),{className:o,isExternal:l,...c}=Le(t);return e.jsx(X.a,{target:l?"_blank":void 0,rel:l?"noopener":void 0,ref:s,className:Ot("chakra-link",o),...c,__css:n})});Ue.displayName="Link";var[ws,$e]=bt({name:"TagStylesContext",errorMessage:`useTagStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tag />" `}),oe=F((r,t)=>{const s=vt("Tag",r),n=Le(r),o={display:"inline-flex",verticalAlign:"top",alignItems:"center",maxWidth:"100%",...s.container};return e.jsx(ws,{value:s,children:e.jsx(X.span,{ref:t,...n,__css:o})})});oe.displayName="Tag";var le=F((r,t)=>{const s=$e();return e.jsx(X.span,{ref:t,noOfLines:1,...r,__css:s.label})});le.displayName="TagLabel";var Ns=F((r,t)=>e.jsx(Y,{ref:t,verticalAlign:"top",marginEnd:"0.5rem",...r}));Ns.displayName="TagLeftIcon";var Fs=F((r,t)=>e.jsx(Y,{ref:t,verticalAlign:"top",marginStart:"0.5rem",...r}));Fs.displayName="TagRightIcon";var We=r=>e.jsx(Y,{verticalAlign:"inherit",viewBox:"0 0 512 512",...r,children:e.jsx("path",{fill:"currentColor",d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})});We.displayName="TagCloseIcon";var ks=F((r,t)=>{const{isDisabled:s,children:n,...o}=r,c={display:"flex",alignItems:"center",justifyContent:"center",outline:"0",...$e().closeButton};return e.jsx(X.button,{ref:t,"aria-label":"close",...o,type:"button",disabled:s,__css:c,children:n||e.jsx(We,{})})});ks.displayName="TagCloseButton";const Ms=()=>e.jsxs(e.Fragment,{children:[e.jsx(Pe,{}),e.jsx(we,{children:e.jsx(b,{width:"full",sx:{mt:8,mb:4},children:e.jsxs(Z,{templateColumns:"1fr",alignItems:"center",gap:4,children:[e.jsx(E,{children:e.jsx(z,{height:"120px"})}),e.jsx(E,{children:e.jsx(z,{height:"120px"})}),e.jsx(E,{children:e.jsx(z,{height:"120px"})}),e.jsx(E,{children:e.jsx(z,{height:"120px"})}),e.jsx(E,{children:e.jsx(z,{height:"120px"})}),e.jsx(E,{children:e.jsx(z,{height:"120px"})})]})})})]});function Hs(r){return r&&typeof r=="object"&&"default"in r?r.default:r}var G=Hs(O),Bs=Object.assign||function(r){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(r[n]=s[n])}return r},Us=function(r,t){var s={};for(var n in r)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(r,n)&&(s[n]=r[n]);return s},Oe=function(t){var s=t.color,n=s===void 0?"currentColor":s,o=t.size,l=o===void 0?24:o;t.children;var c=Us(t,["color","size","children"]),m="mdi-icon "+(c.className||"");return G.createElement("svg",Bs({},c,{className:m,width:l,height:l,fill:n,viewBox:"0 0 24 24"}),G.createElement("path",{d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"}))},$s=G.memo?G.memo(Oe):Oe,Ws=$s;const Vs=ue(Ws);let A;typeof window<"u"?A=window:typeof self<"u"?A=self:A=global;let ce=null,de=null;const be=20,re=A.clearTimeout,ve=A.setTimeout,ne=A.cancelAnimationFrame||A.mozCancelAnimationFrame||A.webkitCancelAnimationFrame,Ae=A.requestAnimationFrame||A.mozRequestAnimationFrame||A.webkitRequestAnimationFrame;ne==null||Ae==null?(ce=re,de=function(t){return ve(t,be)}):(ce=function([t,s]){ne(t),re(s)},de=function(t){const s=Ae(function(){re(n),t()}),n=ve(function(){ne(s),t()},be);return[s,n]});function Gs(r){let t,s,n,o,l,c,m;const _=typeof document<"u"&&document.attachEvent;if(!_){c=function(h){const g=h.__resizeTriggers__,R=g.firstElementChild,D=g.lastElementChild,C=R.firstElementChild;D.scrollLeft=D.scrollWidth,D.scrollTop=D.scrollHeight,C.style.width=R.offsetWidth+1+"px",C.style.height=R.offsetHeight+1+"px",R.scrollLeft=R.scrollWidth,R.scrollTop=R.scrollHeight},l=function(h){return h.offsetWidth!==h.__resizeLast__.width||h.offsetHeight!==h.__resizeLast__.height},m=function(h){if(h.target.className&&typeof h.target.className.indexOf=="function"&&h.target.className.indexOf("contract-trigger")<0&&h.target.className.indexOf("expand-trigger")<0)return;const g=this;c(this),this.__resizeRAF__&&ce(this.__resizeRAF__),this.__resizeRAF__=de(function(){l(g)&&(g.__resizeLast__.width=g.offsetWidth,g.__resizeLast__.height=g.offsetHeight,g.__resizeListeners__.forEach(function(C){C.call(g,h)}))})};let i=!1,d="";n="animationstart";const a="Webkit Moz O ms".split(" ");let u="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),j="";{const h=document.createElement("fakeelement");if(h.style.animationName!==void 0&&(i=!0),i===!1){for(let g=0;g<a.length;g++)if(h.style[a[g]+"AnimationName"]!==void 0){j=a[g],d="-"+j.toLowerCase()+"-",n=u[g],i=!0;break}}}s="resizeanim",t="@"+d+"keyframes "+s+" { from { opacity: 0; } to { opacity: 0; } } ",o=d+"animation: 1ms "+s+"; "}const f=function(i){if(!i.getElementById("detectElementResize")){const d=(t||"")+".resize-triggers { "+(o||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',a=i.head||i.getElementsByTagName("head")[0],u=i.createElement("style");u.id="detectElementResize",u.type="text/css",r!=null&&u.setAttribute("nonce",r),u.styleSheet?u.styleSheet.cssText=d:u.appendChild(i.createTextNode(d)),a.appendChild(u)}};return{addResizeListener:function(i,d){if(_)i.attachEvent("onresize",d);else{if(!i.__resizeTriggers__){const a=i.ownerDocument,u=A.getComputedStyle(i);u&&u.position==="static"&&(i.style.position="relative"),f(a),i.__resizeLast__={},i.__resizeListeners__=[],(i.__resizeTriggers__=a.createElement("div")).className="resize-triggers";const j=a.createElement("div");j.className="expand-trigger",j.appendChild(a.createElement("div"));const h=a.createElement("div");h.className="contract-trigger",i.__resizeTriggers__.appendChild(j),i.__resizeTriggers__.appendChild(h),i.appendChild(i.__resizeTriggers__),c(i),i.addEventListener("scroll",m,!0),n&&(i.__resizeTriggers__.__animationListener__=function(R){R.animationName===s&&c(i)},i.__resizeTriggers__.addEventListener(n,i.__resizeTriggers__.__animationListener__))}i.__resizeListeners__.push(d)}},removeResizeListener:function(i,d){if(_)i.detachEvent("onresize",d);else if(i.__resizeListeners__.splice(i.__resizeListeners__.indexOf(d),1),!i.__resizeListeners__.length){i.removeEventListener("scroll",m,!0),i.__resizeTriggers__.__animationListener__&&(i.__resizeTriggers__.removeEventListener(n,i.__resizeTriggers__.__animationListener__),i.__resizeTriggers__.__animationListener__=null);try{i.__resizeTriggers__=!i.removeChild(i.__resizeTriggers__)}catch{}}}}}class qs extends O.Component{constructor(...t){super(...t),this.state={height:this.props.defaultHeight||0,scaledHeight:this.props.defaultHeight||0,scaledWidth:this.props.defaultWidth||0,width:this.props.defaultWidth||0},this._autoSizer=null,this._detectElementResize=null,this._parentNode=null,this._resizeObserver=null,this._timeoutId=null,this._onResize=()=>{this._timeoutId=null;const{disableHeight:s,disableWidth:n,onResize:o}=this.props;if(this._parentNode){const l=window.getComputedStyle(this._parentNode)||{},c=parseFloat(l.paddingLeft||"0"),m=parseFloat(l.paddingRight||"0"),_=parseFloat(l.paddingTop||"0"),f=parseFloat(l.paddingBottom||"0"),x=this._parentNode.getBoundingClientRect(),p=x.height-_-f,i=x.width-c-m,d=this._parentNode.offsetHeight-_-f,a=this._parentNode.offsetWidth-c-m;(!s&&(this.state.height!==d||this.state.scaledHeight!==p)||!n&&(this.state.width!==a||this.state.scaledWidth!==i))&&(this.setState({height:d,width:a,scaledHeight:p,scaledWidth:i}),typeof o=="function"&&o({height:d,scaledHeight:p,scaledWidth:i,width:a}))}},this._setRef=s=>{this._autoSizer=s}}componentDidMount(){const{nonce:t}=this.props,s=this._autoSizer?this._autoSizer.parentNode:null;if(s!=null&&s.ownerDocument&&s.ownerDocument.defaultView&&s instanceof s.ownerDocument.defaultView.HTMLElement){this._parentNode=s;const n=s.ownerDocument.defaultView.ResizeObserver;n!=null?(this._resizeObserver=new n(()=>{this._timeoutId=setTimeout(this._onResize,0)}),this._resizeObserver.observe(s)):(this._detectElementResize=Gs(t),this._detectElementResize.addResizeListener(s,this._onResize)),this._onResize()}}componentWillUnmount(){this._parentNode&&(this._detectElementResize&&this._detectElementResize.removeResizeListener(this._parentNode,this._onResize),this._timeoutId!==null&&clearTimeout(this._timeoutId),this._resizeObserver&&this._resizeObserver.disconnect())}render(){const{children:t,defaultHeight:s,defaultWidth:n,disableHeight:o=!1,disableWidth:l=!1,doNotBailOutOnEmptyChildren:c=!1,nonce:m,onResize:_,style:f={},tagName:x="div",...p}=this.props,{height:i,scaledHeight:d,scaledWidth:a,width:u}=this.state,j={overflow:"visible"},h={};let g=!1;return o||(i===0&&(g=!0),j.height=0,h.height=i,h.scaledHeight=d),l||(u===0&&(g=!0),j.width=0,h.width=u,h.scaledWidth=a),c&&(g=!1),O.createElement(x,{ref:this._setRef,style:{...j,...f},...p},!g&&t(h))}}const Ks=r=>{const{isDraft:t,isOpen:s,onClose:n}=r,o=O.useRef(),{state:l,retry:c}=Es(),m=()=>{const{filteredData:_,handleSearchInputChange:f}=Ne(o.current??[],["screen_name"]),x=30,p=({style:i,index:d,data:a})=>{const u=a?.[d];return u!=null?e.jsx(e.Fragment,{children:e.jsx(vs,{style:i,children:u.habilitado?e.jsx(Ue,{href:P(t?wt:Nt,{client:u.id}),children:e.jsxs(b,{children:[e.jsx(De,{as:Ds,color:"green.400"}),u.screen_name]})}):e.jsxs(b,{color:"gray.400",sx:{cursor:"not-allowed"},children:[e.jsx(De,{as:Rs,color:"red.400"}),u.screen_name]})},u.id)}):e.jsx(e.Fragment,{})};return e.jsxs(e.Fragment,{children:[e.jsx(b,{sx:{pb:4},children:e.jsx(Fe,{handleSearchInputChange:f})}),e.jsx(qs,{children:({height:i,width:d})=>e.jsx(Os,{height:i-60,itemCount:_.length??0,itemSize:x,innerElementType:bs,width:d,itemData:_,children:p})})]})};return e.jsxs(At,{isCentered:!0,isOpen:s,onClose:n,scrollBehavior:"inside",size:{base:"full",sm:"md",md:"lg"},children:[e.jsx(Ct,{bg:"blackAlpha.800"}),e.jsxs(It,{sx:{maxHeight:"auto"},children:[e.jsx(St,{children:"Seleccione el cliente"}),e.jsx(yt,{}),e.jsx(Lt,{minHeight:{base:"auto",sm:"420px !important"},children:l.map({loading:_=>e.jsxs(As,{spacing:4,children:[e.jsx(pe,{width:"full",height:"36px",borderRadius:"md"}),e.jsx(pe,{width:"full",height:"250px",borderRadius:"md"})]}),error:({error:_})=>e.jsx(ze,{error:_,retry:c,cancelAndNavigateTo:zt}),success:_=>(o.current=Pt.sortBy(_.data,["screen_name"]),e.jsx(m,{}))})})]})]})},he="setUnsetSelectedPedido",Xs=({isDraft:r,pedidos:t,stateRenglones:s,handleSearchInputChange:n})=>{const o=Me(),[l,c]=O.useState(!1),{isOpen:m,onOpen:_,onClose:f}=is(),[x,p]=O.useState([]);O.useRef({pedidos:[],renglones:{}}),O.useEffect(()=>{const j=({id:h,checked:g})=>{p(g?R=>[...R,h]:R=>R.filter(D=>D!==h))};return w.on(he,j),()=>{w.removeListener(he,j)}},[]);const i=()=>{if(o.authState.isCustomer()){o.navigate(r?Ht:Bt);return}c(!0),_()},d=()=>{f(),c(!1)},a=()=>{Array.isArray(x)&&window.open(`${Ut}?orderId=${x.join("&orderId=")}`,"OrderPrintWindow","width=800,height=600")},u=x.length<=0?void 0:x.length==1?`1 ${gs}`:`${x.length} ${xs}`;return e.jsxs(e.Fragment,{children:[e.jsxs(H,{flex:1,alignItems:"center",justifyContent:"space-between",sx:{mx:4},children:[e.jsxs(Te,{spacing:{base:2,sm:3},alignItems:"center",children:[(o.authState.isSeller()||o.authState.isCustomer())&&e.jsx(e.Fragment,{children:e.jsx(Ee,{icon:Vs,text:r?Ft:kt,sharedProps:{size:"sm",fontWeight:"400",colorScheme:r?"green":"orange",onClick:()=>{i()},isDisabled:!r&&!o.authState.userInfo.puede_crear_pedido},iconProps:{boxSize:{base:5,md:4}}})}),!r&&e.jsx(Ee,{icon:ds,text:Mt,sharedProps:{size:"sm",fontWeight:"400",colorScheme:"blue",onClick:()=>a(),isDisabled:x.length<=0},iconProps:{boxSize:{base:5,md:4}}}),u!=null&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{display:{base:"none",sm:"inherited"},height:8,borderRadius:40,size:"md",variant:"solid",colorScheme:"blue",children:e.jsx(le,{marginX:1,children:u})}),e.jsx(oe,{display:{base:"inherited",sm:"none"},height:8,borderRadius:40,size:"md",variant:"solid",colorScheme:"blue",children:e.jsx(le,{marginX:1,children:x.length})})]})]}),e.jsx(H,{alignItems:"center",marginLeft:4,children:e.jsx(Te,{spacing:{base:2,md:4},children:e.jsx(b,{children:e.jsx(Fe,{handleSearchInputChange:n})})})})]}),l&&e.jsx(Ks,{isDraft:r,isOpen:m,onClose:d})]})};function Ys(r){return r&&typeof r=="object"&&"default"in r?r.default:r}var q=Ys(O),Zs=Object.assign||function(r){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(r[n]=s[n])}return r},Js=function(r,t){var s={};for(var n in r)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(r,n)&&(s[n]=r[n]);return s},Ce=function(t){var s=t.color,n=s===void 0?"currentColor":s,o=t.size,l=o===void 0?24:o;t.children;var c=Js(t,["color","size","children"]),m="mdi-icon "+(c.className||"");return q.createElement("svg",Zs({},c,{className:m,width:l,height:l,fill:n,viewBox:"0 0 24 24"}),q.createElement("path",{d:"M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"}))},Qs=q.memo?q.memo(Ce):Ce,er=Qs;const tr=ue(er);function sr(r,t){return t.isSuccess()?hs(r,t.data[r.id]):r.estado}function Ve(r,t){let s;switch(r){case M.INGRESADO:s="blue";break;case M.APROBADO:s="purple";break;case M.CUMPLIDO:s="green";break;case M.CERRADO:s="black";break;case M.ANULADO:s="red";break;default:s="gray"}return t==null?s:`${s}${t}`}function rr(r){return r&&typeof r=="object"&&"default"in r?r.default:r}var K=rr(O),nr=Object.assign||function(r){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(r[n]=s[n])}return r},ir=function(r,t){var s={};for(var n in r)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(r,n)&&(s[n]=r[n]);return s},Ie=function(t){var s=t.color,n=s===void 0?"currentColor":s,o=t.size,l=o===void 0?24:o;t.children;var c=ir(t,["color","size","children"]),m="mdi-icon "+(c.className||"");return K.createElement("svg",nr({},c,{className:m,width:l,height:l,fill:n,viewBox:"0 0 24 24"}),K.createElement("path",{d:"M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z"}))},ar=K.memo?K.memo(Ie):Ie,or=ar;const lr=ue(or),cr=({app:r,isDraft:t,pedido:s,onDelete:n,onMarkAsFavorite:o})=>{const l=r.authState.userInfo,c=r.authState.isAdmin(),m=t&&s.es_favorito,_=!c&&(t||l.puede_crear_pedido),f=!c&&t&&l.puede_crear_pedido,x=!c&&!t,p=!c&&(t||l.puede_editar_pedido&&us(l,s.estado)),i=!m&&(t||je(l,s.estado)),d=t||l.borrar_pedido_al_anular,a=[];return p&&a.push(e.jsx(S,{onClick:()=>{r.navigate(P(t?Wt:Vt,{id:s.id}))},children:Xe},a.length)),_&&a.push(e.jsx(S,{onClick:()=>{r.navigate(P(t?Gt:qt,{id:s.id}))},children:Ye},a.length)),f&&a.push(e.jsx(S,{onClick:()=>{r.navigate(P(Kt,{id:s.id}))},children:m?Ze:Je},a.length)),x&&a.push(e.jsx(S,{onClick:()=>{r.navigate(P(Xt,{id:s.id}))},children:Qe},a.length)),t&&!m&&(f&&a.push(e.jsx(S,{onClick:()=>{r.navigate(P(Yt,{id:s.id}))},children:et},a.length)),a.length>0&&a.push(e.jsx(se,{},a.length)),a.push(e.jsx(S,{onClick:()=>o(s.id,!0),children:tt},a.length))),m&&(a.length>0&&a.push(e.jsx(se,{},a.length)),a.push(e.jsx(S,{onClick:()=>o(s.id,!1),children:st},a.length))),(t||je(l,s.estado))&&(a.length>0&&a.push(e.jsx(se,{},a.length)),a.push(e.jsx(S,{onClick:()=>n(s.id),isDisabled:m||!i,children:m?rt:d?nt:it},a.length))),e.jsxs(Cs,{isLazy:!0,id:"menu",children:[e.jsx(rs,{as:Is,size:"sm","aria-label":fs,icon:e.jsx(lr,{}),variant:"outline",colorScheme:"white"}),e.jsx($t,{children:e.jsx(ns,{rootProps:{zIndex:2e3},children:a})})]})},dr=()=>e.jsxs(L,{status:"warning",children:[e.jsx(me,{}),e.jsx(_e,{children:"El pedido no cuenta con productos."})]}),hr=()=>e.jsxs(L,{status:"error",children:[e.jsx(me,{}),e.jsx(_e,{children:"Ocurrió un error al cargar los detalles del pedido."})]}),ur=()=>e.jsx(b,{width:"full",sx:{mt:8,mb:4},children:e.jsxs(Z,{templateColumns:"1fr",alignItems:"center",gap:2,children:[e.jsx(E,{children:e.jsx(U,{height:"20px"})}),e.jsx(E,{children:e.jsx(U,{height:"20px"})}),e.jsx(E,{children:e.jsx(U,{height:"20px"})}),e.jsx(E,{children:e.jsx(U,{height:"20px"})})]})}),mr=({pedido:r,renglones:t,esCliente:s})=>{const n=ae("var(--chakra-colors-gray-200)","var(--chakra-colors-black)"),o=ae("var(--chakra-colors-gray-400)","var(--chakra-colors-black)"),{numero_pedido:l,descuento:c}=r,m=c>0||!s;return e.jsxs("table",{width:"100%",cellPadding:8,cellSpacing:4,style:{fontSize:"0.8rem",border:`1px solid ${o}`},children:[e.jsx("thead",{style:{backgroundColor:`${n}`,textTransform:"uppercase"},children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left",style:{width:m?"60%":"70%"},children:"Artículo"}),e.jsx("th",{className:"text-right hidden-on-base",style:{width:"10%"},children:"Precio"}),m&&e.jsx("th",{className:"text-right",style:{width:"10%"},children:"Bonificado"}),e.jsx("th",{className:"text-center",style:{width:"10%"},children:"Cantidad"}),e.jsx("th",{className:"text-right",style:{width:"10%"},children:"Subtotal"})]})}),e.jsx("tbody",{children:t.map(({id_articulo:_,nombre_articulo:f,codigo_articulo:x,descripcion_adicional:p,precio:i,cantidad:d,es_precio_especial:a},u)=>{const j=i!=null?i*d:null,h=fe(i,c),g=fe(j,c);return e.jsxs("tr",{style:{color:i==null?"red":void 0},children:[e.jsx("td",{children:e.jsx(N,{children:at(f,x,p)})}),e.jsx("td",{className:"text-right hidden-on-base",children:a&&i!=null?"Especial":e.jsx(W,{precio:i,moneda:"$"})}),m&&e.jsx("td",{className:"text-right",children:e.jsx(W,{precio:h,moneda:"$"})}),e.jsx("td",{children:e.jsx(V,{textAlign:"center",children:d})}),e.jsx("td",{className:"text-right",children:e.jsx(W,{precio:g,moneda:"$"})})]},`details-${l}-${u}`)})})]})},_r=({wasOpen:r,pedido:t,stateRenglones:s,esCliente:n})=>e.jsx(b,{sx:{mt:6},children:r&&s.map({loading:o=>e.jsx(ur,{}),error:o=>e.jsx(hr,{}),success:o=>{const{id:l}=t,c=o.data?.[l];return Array.isArray(c)?e.jsx(mr,{pedido:t,renglones:c,esCliente:n}):e.jsx(dr,{})}})}),gr=({estado:r})=>{const t=ms(r),s=Ve(r);return e.jsx(Ss,{fontSize:"1em",variant:"solid",colorScheme:s,lineHeight:"1.5em",children:t})},$=r=>{const{children:t}=r;return e.jsx(H,{direction:{base:"row",lg:"column"},gap:4,children:t})},y=r=>{const{children:t}=r;return e.jsx(H,{direction:"column",flex:1,children:t})};function Ge({total:r,descuento:t,taxesLabel:s}){const n=`TOTAL ${t>0?`-${t}%`:""}`;return e.jsxs(y,{children:[e.jsxs(v,{size:"sm",sx:{textTransform:"uppercase",whiteSpace:"normal"},children:[e.jsx("div",{children:n}),e.jsx("div",{children:s})]}),e.jsx(v,{size:"md",sx:{fontWeight:"bolder"},children:r!=null&&e.jsx(W,{precio:r,moneda:"$"})})]})}const xr=r=>{const{app:t,pedido:s,total:n,estado:o,handleToggleDetails:l}=r,{numero_pedido:c,fecha_hora_ingreso:m,fecha_entrega:_,codigo_cliente:f,codigo_vendedor:x,codigo_transporte:p,nombre_cliente:i,nombre_vendedor:d,nombre_transporte:a,descuento:u,mensaje_interno:j,leyenda1:h,leyenda2:g,leyenda3:R,leyenda4:D,leyenda5:C,cliente_exento_iva:T,cliente_exento_ii:I}=s,k=t.authState.isSeller(),J=t.authState.isAdmin(),B=ke(h,g,R,D,C),ge=B.length>0,Q=j!=null&&j.length>0,ee=!T&&!I?"":`${ye(T,I)}`;return e.jsxs(Z,{templateColumns:{base:"repeat(1, 1fr)",lg:"repeat(4, 1fr)"},gap:4,sx:{cursor:"pointer"},onClick:()=>{l()},children:[e.jsx(E,{children:e.jsxs($,{children:[e.jsxs(y,{children:[e.jsx(v,{size:"sm",children:"Pedido"}),e.jsx(V,{children:c})]}),e.jsxs(y,{children:[e.jsx(v,{size:"sm",children:"Estado"}),e.jsx(b,{children:e.jsx(gr,{estado:o})})]})]})}),e.jsx(E,{children:e.jsxs($,{children:[e.jsxs(y,{children:[e.jsx(v,{size:"sm",children:"Ingreso"}),e.jsx(V,{children:Zt(m)})]}),_!=null&&e.jsxs(y,{children:[e.jsx(v,{size:"sm",children:"Entrega"}),e.jsx(V,{children:Jt(_)})]})]})}),(J||k)&&e.jsx(E,{children:e.jsxs($,{children:[e.jsxs(y,{children:[e.jsxs(v,{size:"sm",children:["Cliente ",f]}),e.jsx(N,{children:i})]}),!k&&e.jsxs(y,{children:[e.jsxs(v,{size:"sm",children:["Vendedor ",x]}),e.jsx(N,{children:d})]})]})}),e.jsx(E,{children:e.jsxs($,{children:[e.jsxs(y,{children:[e.jsxs(v,{size:"sm",children:["Transporte ",p]}),e.jsx(N,{children:a})]}),e.jsx(Ge,{total:n,descuento:u,taxesLabel:ee})]})}),ge&&e.jsx(E,{colSpan:{lg:4},children:e.jsx(L,{status:"warning",sx:{flexDirection:"column",alignItems:"flex-start",bgColor:"yellow.300"},children:B.map((qe,Ke)=>e.jsx(b,{sx:{whiteSpace:"normal",marginBottom:1},children:qe.v},Ke))})}),Q&&e.jsx(E,{colSpan:{lg:4},children:e.jsx(L,{status:"info",sx:{flexDirection:"column",alignItems:"flex-start"},children:j})})]})},fr=r=>{const{app:t,pedido:s,estado:n,total:o,handleToggleDetails:l}=r,{codigo_cliente:c,codigo_vendedor:m,codigo_transporte:_,nombre_cliente:f,nombre_vendedor:x,nombre_transporte:p,descuento:i,descripcion:d,leyenda1:a,leyenda2:u,leyenda3:j,leyenda4:h,leyenda5:g,es_favorito:R,mensaje_interno:D,cliente_exento_iva:C,cliente_exento_ii:T}=s;t.authState.isSeller();const I=t.authState.isCustomer(),k=ke(a,u,j,h,g),J=k.length>0,B=D!=null&&D.length>0,Q=!C&&!T?"":`(${ye(C,T)})`;return e.jsxs(Z,{templateColumns:{base:"repeat(1, 1fr)",md:"repeat(2, 1fr)",lg:"repeat(3, 1fr)"},gap:6,sx:{cursor:"pointer"},onClick:()=>{l()},children:[e.jsx(E,{colSpan:{lg:3,md:2},children:e.jsx(v,{size:"md",textTransform:"uppercase",children:d})}),!I&&e.jsxs(E,{children:[e.jsxs(v,{size:"sm",children:["Cliente ",c]}),e.jsx(N,{children:f})]}),e.jsxs(E,{children:[e.jsxs(v,{size:"sm",children:["Transporte ",_]}),e.jsx(N,{children:p})]}),e.jsx(Ge,{total:o,descuento:i,taxesLabel:Q}),J&&e.jsx(E,{colSpan:{lg:3,md:2},children:e.jsx(L,{status:"warning",sx:{flexDirection:"column",alignItems:"flex-start",bgColor:"yellow.300"},children:k.map((xe,ee)=>e.jsx(b,{sx:{whiteSpace:"normal",marginBottom:1},children:xe.v},ee))})}),B&&e.jsx(E,{colSpan:{lg:3,md:2},children:e.jsx(L,{status:"info",sx:{flexDirection:"column",alignItems:"flex-start"},children:D})})]})};function pr(r,t){return t.isSuccess()?_s(r,t.data[r.id]):null}const ie="togglePedidoDetails",jr=({index:r,app:t,draft:s,pedido:n,stateRenglones:o,handleDelete:l,handleMarkAsFavorite:c,isHidden:m})=>{const[_,f]=O.useState(!1),[x,p]=O.useState(!1),i=ae("gray.800","white"),d=O.useRef(!1),a=sr(n,o),u=n.total!=null?n.total:pr(n,o),j=O.useMemo(()=>e.jsx(_r,{wasOpen:d.current,pedido:n,stateRenglones:o,esCliente:t.authState.isCustomer()}),[d.current,o.constructor.name]),h=()=>{const T=!_;T&&(d.current=!0),f(T),w.emit(ie,{id:n.id})},g=(T,I)=>{p(!!T),w.emit(he,{id:I,checked:T})};O.useEffect(()=>{const T=({id:I})=>{n.id!==I&&f(!1)};return w.on(ie,T),()=>{w.removeListener(ie,T)}},[]);const{id:R,es_favorito:D}=n,C=s&&D;return e.jsx(He,{sx:{...m&&!x&&{display:"none"}},children:e.jsxs(Be,{sx:{py:6,position:"relative",borderTopWidth:s?void 0:{base:"3px",md:"4px"},borderTopStyle:s?void 0:"solid",borderTopColor:s?void 0:Ve(a,".500 !important"),borderWidth:s?{base:"2px",md:"3px"}:void 0,borderStyle:s?"dashed":void 0,borderColor:s?D?"orange.500 !important":"blue.500 !important":void 0},children:[e.jsxs(b,{display:"flex",sx:{position:"absolute",right:2,top:5},flexDirection:"column",children:[e.jsx(cr,{app:t,isDraft:s,pedido:n,onDelete:l,onMarkAsFavorite:c}),C&&e.jsx(H,{backgroundColor:"orange",justifyContent:"center",alignItems:"center",sx:{mt:2,borderRadius:4,aspectRatio:1},children:e.jsx(Y,{as:tr,boxSize:4,color:"white"})}),!s&&e.jsx(ys,{size:"xl",colorScheme:"blue",sx:{mt:2,borderWidth:0,borderColor:i,backgroundColor:"white"},onChange:T=>{g(T.target.checked,R)}})]}),s?e.jsx(fr,{app:t,pedido:n,estado:a,total:u,handleToggleDetails:h}):e.jsx(xr,{app:t,pedido:n,estado:a,total:u,handleToggleDetails:h}),e.jsx(b,{children:e.jsx(b,{sx:{display:_?"block":"none"},children:j})},`pedido-details-${r}`)]})})};function Er(r){const t=Me(),n=t.authState.userInfo.borrar_pedido_al_anular.valueOf(),{draft:o,unfilteredPedidos:l,filteredPedidos:c,isFiltering:m,stateRenglones:_,reloadData:f}=r,x=Ps(),p=Ts(),i=async a=>{if(await p({title:o?lt:n?ct:dt,message:o?ht:n?ut:mt})==Re.accept){const j=o?await as(a,t):await os(a,t);j.map({success:h=>{x({title:o?_t:n?gt:xt,status:"success"})},error:h=>{x({title:h.errorInfoOrNull()?.error_description??es,status:"error"})}}),j.isSuccess()&&await f()}},d=async(a,u)=>{if(u){(await ls(a,t)).isSuccess()&&await f();return}await p({title:ft,message:pt})==Re.accept&&(await cs(a,t)).isSuccess()&&await f()};return e.jsx(ot,{sx:{p:0,m:0},children:e.jsx(Ls,{variant:"stripedOverCard",colorScheme:"gray",size:"md",sx:{borderCollapse:"separate",borderSpacing:"0 1rem"},children:e.jsxs(zs,{children:[l.map((a,u)=>e.jsx(jr,{index:u,draft:o,app:t,pedido:a,stateRenglones:_,handleDelete:i,handleMarkAsFavorite:d,isHidden:m&&!c.includes(a)},`pedido-${a.id}`)),!c.length&&e.jsx(He,{children:e.jsx(Be,{children:e.jsxs(L,{status:"info",children:[e.jsx(me,{}),e.jsx(_e,{children:m?Qt:o?ps:js})]})})})]})})})}const Rr=r=>{const{showDrafts:t,pedidos:s,reloadData:n}=r,o=ts().state.userOrThrow(),l=o.role==te.admin;o.role==te.seller;const c=o.role==te.customer,{filteredData:m,handleSearchInputChange:_,isFiltering:f}=Ne(s,["descripcion","comentarios",...t?[]:["numero_pedido"],...c?[]:["codigo_cliente","nombre_cliente"],...l?["codigo_vendedor","nombre_vendedor"]:[]]),{state:x}=Se({...t?jt:Et,silent:!0,transformResponse:p=>(Object.values(p).forEach(i=>{Array.isArray(i)&&i.sort((d,a)=>d.renglon-a.renglon)}),p)});return e.jsxs(e.Fragment,{children:[e.jsx(Pe,{children:e.jsx(Xs,{isDraft:t,pedidos:s,stateRenglones:x,handleSearchInputChange:_})}),e.jsx(we,{children:e.jsx(Er,{draft:t,stateRenglones:x,unfilteredPedidos:s,filteredPedidos:m,isFiltering:f,reloadData:n})})]})},sn=r=>{const t=r.showDrafts===!0,{state:s,retry:n,reload:o}=Se({...t?Rt:Dt,silent:!0});return s.map({loading:l=>e.jsx(Ms,{}),error:({error:l})=>e.jsx(ze,{error:l,retry:n,cancelAndNavigateTo:ss}),success:l=>{const c=t?l.data.sort(Dr):l.data.sort(Tr);return e.jsx(Rr,{showDrafts:t,pedidos:c,reloadData:o})}})};function Dr(r,t){const s=r.es_favorito?1:0,n=t.es_favorito?1:0,o=s-n;if(o!=0)return o;const l=new Date(r.fecha_hora_ingreso).getTime();return new Date(t.fecha_hora_ingreso).getTime()-l}function Tr(r,t){const s=r.estado-t.estado;if(s!=0)return s;const n=r.numero_pedido,o=t.numero_pedido;return n.localeCompare(o)}export{sn as O};
